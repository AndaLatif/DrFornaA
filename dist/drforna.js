!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):"object"==typeof exports?exports.drforna=e(require("d3")):t.drforna=e(t.d3)}(window,function(t){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(e,n){e.exports=t},function(t,e,n){t.exports={plot:"drforna-plot",timeIndicator:"drforna-timeIndicator",timeLabel:"drforna-timeLabel",lineChart:"drforna-lineChart",overlay:"drforna-overlay",treemap:"drforna-treemap",treemapNode:"drforna-treemapNode",axis:"drforna-axis",y:"drforna-y",line:"drforna-line",timePointTable:"drforna-timePointTable",tablestruct:"drforna-tablestruct",tablename:"drforna-tablename",tablesize:"drforna-tablesize",tableenergy:"drforna-tableenergy"}},function(t,e,n){var o;window,t.exports=(o=n(0),function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=16)}([function(t,e){t.exports=o},function(t,e,n){t.exports={nodeStrokeWidth:"0.8",directionArrowSize:"6",directionArrowWidth:"0.7",node:"fornac-node",directionArrow:"fornac-directionArrow",plot:"fornac-plot",selectedNode:"fornac-selectedNode",nodeLabel:"fornac-nodeLabel",link:"fornac-link",plotLabel:"fornac-plotLabel",transparent:"fornac-transparent",dragLine:"fornac-dragLine",mouseEventHelper:"fornac-mouseEventHelper"}},function(t,e,n){t.exports=n(8)},function(t,e,n){"use strict";n.r(e),n.d(e,"Connection",function(){return i});var r=n(4),o=n(5);function i(){this.loop=new r.a,this.region=new o.a,this.start=null,this.end=null,this.xrad=null,this.yrad=null,this.angle=null,this.extruded=null,this.broken=null,this._isNull=!1}i.prototype.isNull=function(){return this._isNull},i.prototype.setNull=function(t){this._isNull=t},i.prototype.getLoop=function(){return this.loop},i.prototype.setLoop=function(t){this.loop=t},i.prototype.getRegion=function(){return this.region},i.prototype.setRegion=function(t){this.region=t},i.prototype.getStart=function(){return this.start},i.prototype.setStart=function(t){this.start=t},i.prototype.getEnd=function(){return this.end},i.prototype.setEnd=function(t){this.end=t},i.prototype.getXrad=function(){return this.xrad},i.prototype.setXrad=function(t){this.xrad=t},i.prototype.getYrad=function(){return this.yrad},i.prototype.setYrad=function(t){this.yrad=t},i.prototype.getAngle=function(){return this.angle},i.prototype.setAngle=function(t){this.angle=t},i.prototype.isExtruded=function(){return this.extruded},i.prototype.setExtruded=function(t){this.extruded=t},i.prototype.isBroken=function(){return this.broken},i.prototype.setBroken=function(t){this.broken=t}},function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(3);function o(){this.nconnection=null,this.connections=[],this._connections=[],this.number=null,this.depth=null,this.mark=null,this.x=null,this.y=null,this.radius=null}o.prototype.getNconnection=function(){return this.nconnection},o.prototype.setNconnection=function(t){this.nconnection=t},o.prototype.setConnection=function(t,e){null!=e?this._connections[t]=e:(this._connections[t]||(this._connections[t]=new r.Connection),this._connections[t].setNull(!0))},o.prototype.getConnection=function(t){var e=n(3);this._connections[t]||(this._connections[t]=new e);var r=this._connections[t];return r.isNull()?null:r},o.prototype.addConnection=function(t,e){this._connections.push(e)},o.prototype.getNumber=function(){return this.number},o.prototype.setNumber=function(t){this.number=t},o.prototype.getDepth=function(){return this.depth},o.prototype.setDepth=function(t){this.depth=t},o.prototype.isMark=function(){return this.mark},o.prototype.setMark=function(t){this.mark=t},o.prototype.getX=function(){return this.x},o.prototype.setX=function(t){this.x=t},o.prototype.getY=function(){return this.y},o.prototype.setY=function(t){this.y=t},o.prototype.getRadius=function(){return this.radius},o.prototype.setRadius=function(t){this.radius=t}},function(t,e,n){"use strict";function r(){this._start1=null,this._end1=null,this._start2=null,this._end2=null}n.d(e,"a",function(){return r}),r.prototype.getStart1=function(){return this._start1},r.prototype.setStart1=function(t){this._start1=t},r.prototype.getEnd1=function(){return this._end1},r.prototype.setEnd1=function(t){this._end1=t},r.prototype.getStart2=function(){return this._start2},r.prototype.setStart2=function(t){this._start2=t},r.prototype.getEnd2=function(){return this._end2},r.prototype.setEnd2=function(t){this._end2=t}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){t.exports=n.p+"fa9b45d63b40299e0188927ca7d381a3.svg"},function(t,e,n){(function(t){var r=n(13);e.encode=function(e){var n=r.parse(e);return new t(n).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").substring(0,22)},e.decode=function(e){var n=e.replace(/-/g,"+").replace(/_/g,"/")+"==";return r.unparse(new t(n,"base64"))},e.v4=function(){return r.v4(null,new t(16)).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").substring(0,22)},e.nice=function(){var e=r.v4(null,new t(16));return e[0]=127&e[0],e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").substring(0,22)}}).call(this,n(9).Buffer)},function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(10),o=n(11),i=n(12);function a(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=l.prototype:(null===t&&(t=new l(e)),t.length=e),t}function l(t,e,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return d(this,t)}return u(this,t,e,n)}function u(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),l.TYPED_ARRAY_SUPPORT?(t=e).__proto__=l.prototype:t=f(t,e),t}(t,e,n,r):"string"==typeof e?function(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(e,n),o=(t=s(t,r)).write(e,n);return o!==r&&(t=t.slice(0,o)),t}(t,e,n):function(t,e){if(l.isBuffer(e)){var n=0|h(e.length);return 0===(t=s(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?s(t,0):f(t,e);if("Buffer"===e.type&&i(e.data))return f(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function d(t,e){if(c(e),t=s(t,e<0?0:0|h(e)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function f(t,e){var n=e.length<0?0:0|h(e.length);t=s(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function h(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function p(t,e){if(l.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return D(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(t).length;default:if(r)return D(t).length;e=(""+e).toLowerCase(),r=!0}}function g(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function m(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof e&&(e=l.from(e,r)),l.isBuffer(e))return 0===e.length?-1:y(t,e,n,r,o);if("number"==typeof e)return e&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):y(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function y(t,e,n,r,o){var i,a=1,s=t.length,l=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a=2,s/=2,l/=2,n/=2}function u(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(o){var c=-1;for(i=n;i<s;i++)if(u(t,i)===u(e,-1===c?0:i-c)){if(-1===c&&(c=i),i-c+1===l)return c*a}else-1!==c&&(i-=i-c),c=-1}else for(n+l>s&&(n=s-l),i=n;i>=0;i--){for(var d=!0,f=0;f<l;f++)if(u(t,i+f)!==u(e,f)){d=!1;break}if(d)return i}return-1}function v(t,e,n,r){n=Number(n)||0;var o=t.length-n;r?(r=Number(r))>o&&(r=o):r=o;var i=e.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var a=0;a<r;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[n+a]=s}return a}function b(t,e,n,r){return q(D(e,t.length-n),t,n,r)}function k(t,e,n,r){return q(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function x(t,e,n,r){return k(t,e,n,r)}function w(t,e,n,r){return q(z(e),t,n,r)}function A(t,e,n,r){return q(function(t,e){for(var n,r,o,i=[],a=0;a<t.length&&!((e-=2)<0);++a)n=t.charCodeAt(a),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(e,t.length-n),t,n,r)}function E(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function _(t,e,n){n=Math.min(t.length,n);for(var r=[],o=e;o<n;){var i,a,s,l,u=t[o],c=null,d=u>239?4:u>223?3:u>191?2:1;if(o+d<=n)switch(d){case 1:u<128&&(c=u);break;case 2:128==(192&(i=t[o+1]))&&(l=(31&u)<<6|63&i)>127&&(c=l);break;case 3:i=t[o+1],a=t[o+2],128==(192&i)&&128==(192&a)&&(l=(15&u)<<12|(63&i)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:i=t[o+1],a=t[o+2],s=t[o+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(l=(15&u)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),o+=d}return function(t){var e=t.length;if(e<=N)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=N));return n}(r)}e.Buffer=l,e.SlowBuffer=function(t){return+t!=t&&(t=0),l.alloc(+t)},e.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),l.poolSize=8192,l._augment=function(t){return t.__proto__=l.prototype,t},l.from=function(t,e,n){return u(null,t,e,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(t,e,n){return function(t,e,n,r){return c(e),e<=0?s(t,e):void 0!==n?"string"==typeof r?s(t,e).fill(n,r):s(t,e).fill(n):s(t,e)}(null,t,e,n)},l.allocUnsafe=function(t){return d(null,t)},l.allocUnsafeSlow=function(t){return d(null,t)},l.isBuffer=function(t){return!(null==t||!t._isBuffer)},l.compare=function(t,e){if(!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,o=0,i=Math.min(n,r);o<i;++o)if(t[o]!==e[o]){n=t[o],r=e[o];break}return n<r?-1:r<n?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!i(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=l.allocUnsafe(e),o=0;for(n=0;n<t.length;++n){var a=t[n];if(!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,o),o+=a.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},l.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},l.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},l.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?_(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,n);case"utf8":case"utf-8":return _(this,e,n);case"ascii":return L(this,e,n);case"latin1":case"binary":return P(this,e,n);case"base64":return E(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},l.prototype.compare=function(t,e,n,r,o){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),e<0||n>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&e>=n)return 0;if(r>=o)return-1;if(e>=n)return 1;if(this===t)return 0;for(var i=(o>>>=0)-(r>>>=0),a=(n>>>=0)-(e>>>=0),s=Math.min(i,a),u=this.slice(r,o),c=t.slice(e,n),d=0;d<s;++d)if(u[d]!==c[d]){i=u[d],a=c[d];break}return i<a?-1:a<i?1:0},l.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},l.prototype.indexOf=function(t,e,n){return m(this,t,e,n,!0)},l.prototype.lastIndexOf=function(t,e,n){return m(this,t,e,n,!1)},l.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return v(this,t,e,n);case"utf8":case"utf-8":return b(this,t,e,n);case"ascii":return k(this,t,e,n);case"latin1":case"binary":return x(this,t,e,n);case"base64":return w(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var N=4096;function L(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(127&t[o]);return r}function P(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(t[o]);return r}function T(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=e;i<n;++i)o+=X(t[i]);return o}function M(t,e,n){for(var r=t.slice(e,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function S(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function R(t,e,n,r,o,i){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<i)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function C(t,e,n,r){e<0&&(e=65535+e+1);for(var o=0,i=Math.min(t.length-n,2);o<i;++o)t[n+o]=(e&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function I(t,e,n,r){e<0&&(e=4294967295+e+1);for(var o=0,i=Math.min(t.length-n,4);o<i;++o)t[n+o]=e>>>8*(r?o:3-o)&255}function Y(t,e,n,r,o,i){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(t,e,n,r,i){return i||Y(t,0,n,4),o.write(t,e,n,r,23,4),n+4}function O(t,e,n,r,i){return i||Y(t,0,n,8),o.write(t,e,n,r,52,8),n+8}l.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=l.prototype;else{var o=e-t;n=new l(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+t]}return n},l.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||S(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r},l.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||S(t,e,this.length);for(var r=this[t+--e],o=1;e>0&&(o*=256);)r+=this[t+--e]*o;return r},l.prototype.readUInt8=function(t,e){return e||S(t,1,this.length),this[t]},l.prototype.readUInt16LE=function(t,e){return e||S(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUInt16BE=function(t,e){return e||S(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUInt32LE=function(t,e){return e||S(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUInt32BE=function(t,e){return e||S(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||S(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*e)),r},l.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||S(t,e,this.length);for(var r=e,o=1,i=this[t+--r];r>0&&(o*=256);)i+=this[t+--r]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*e)),i},l.prototype.readInt8=function(t,e){return e||S(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){e||S(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(t,e){e||S(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(t,e){return e||S(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return e||S(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readFloatLE=function(t,e){return e||S(t,4,this.length),o.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return e||S(t,4,this.length),o.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return e||S(t,8,this.length),o.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return e||S(t,8,this.length),o.read(this,t,!1,52,8)},l.prototype.writeUIntLE=function(t,e,n,r){t=+t,e|=0,n|=0,r||R(this,t,e,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[e]=255&t;++i<n&&(o*=256);)this[e+i]=t/o&255;return e+n},l.prototype.writeUIntBE=function(t,e,n,r){t=+t,e|=0,n|=0,r||R(this,t,e,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[e+o]=255&t;--o>=0&&(i*=256);)this[e+o]=t/i&255;return e+n},l.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||R(this,t,e,1,255,0),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},l.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||R(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):C(this,t,e,!0),e+2},l.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||R(this,t,e,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):C(this,t,e,!1),e+2},l.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||R(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):I(this,t,e,!0),e+4},l.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||R(this,t,e,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},l.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);R(this,t,e,n,o-1,-o)}var i=0,a=1,s=0;for(this[e]=255&t;++i<n&&(a*=256);)t<0&&0===s&&0!==this[e+i-1]&&(s=1),this[e+i]=(t/a>>0)-s&255;return e+n},l.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);R(this,t,e,n,o-1,-o)}var i=n-1,a=1,s=0;for(this[e+i]=255&t;--i>=0&&(a*=256);)t<0&&0===s&&0!==this[e+i+1]&&(s=1),this[e+i]=(t/a>>0)-s&255;return e+n},l.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||R(this,t,e,1,127,-128),l.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||R(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):C(this,t,e,!0),e+2},l.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||R(this,t,e,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):C(this,t,e,!1),e+2},l.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||R(this,t,e,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):I(this,t,e,!0),e+4},l.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||R(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),l.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},l.prototype.writeFloatLE=function(t,e,n){return B(this,t,e,!0,n)},l.prototype.writeFloatBE=function(t,e,n){return B(this,t,e,!1,n)},l.prototype.writeDoubleLE=function(t,e,n){return O(this,t,e,!0,n)},l.prototype.writeDoubleBE=function(t,e,n){return O(this,t,e,!1,n)},l.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var o,i=r-n;if(this===t&&n<e&&e<r)for(o=i-1;o>=0;--o)t[o+e]=this[o+n];else if(i<1e3||!l.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)t[o+e]=this[o+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+i),e);return i},l.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var o=t.charCodeAt(0);o<256&&(t=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(i=e;i<n;++i)this[i]=t;else{var a=l.isBuffer(t)?t:D(new l(t,r).toString()),s=a.length;for(i=0;i<n-e;++i)this[i+e]=a[i%s]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function X(t){return t<16?"0"+t.toString(16):t.toString(16)}function D(t,e){var n;e=e||1/0;for(var r=t.length,o=null,i=[],a=0;a<r;++a){if((n=t.charCodeAt(a))>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function z(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(U,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function q(t,e,n,r){for(var o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}}).call(this,n(6))},function(t,e,n){"use strict";e.byteLength=function(t){var e=u(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){for(var e,n=u(t),r=n[0],a=n[1],s=new i(NaN),l=0,c=a>0?r-4:r,d=0;d<c;d+=4)e=o[t.charCodeAt(d)]<<18|o[t.charCodeAt(d+1)]<<12|o[t.charCodeAt(d+2)]<<6|o[t.charCodeAt(d+3)],s[l++]=e>>16&255,s[l++]=e>>8&255,s[l++]=255&e;return 2===a&&(e=o[t.charCodeAt(d)]<<2|o[t.charCodeAt(d+1)]>>4,s[l++]=255&e),1===a&&(e=o[t.charCodeAt(d)]<<10|o[t.charCodeAt(d+1)]<<4|o[t.charCodeAt(d+2)]>>2,s[l++]=e>>8&255,s[l++]=255&e),s},e.fromByteArray=function(t){for(var e,n=t.length,o=n%3,i=[],a=0,s=n-o;a<s;a+=16383)i.push(c(t,a,a+16383>s?s:a+16383));return 1===o?(e=t[n-1],i.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],i.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),i.join("")};for(var r=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,l=a.length;s<l;++s)r[s]=a[s],o[a.charCodeAt(s)]=s;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function c(t,e,n){for(var o,i,a=[],s=e;s<n;s+=3)o=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return a.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,o){var i,a,s=8*o-r-1,l=(1<<s)-1,u=l>>1,c=-7,d=n?o-1:0,f=n?-1:1,h=t[e+d];for(d+=f,i=h&(1<<-c)-1,h>>=-c,c+=s;c>0;i=256*i+t[e+d],d+=f,c-=8);for(a=i&(1<<-c)-1,i>>=-c,c+=r;c>0;a=256*a+t[e+d],d+=f,c-=8);if(0===i)i=1-u;else{if(i===l)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,r),i-=u}return(h?-1:1)*a*Math.pow(2,i-r)},e.write=function(t,e,n,r,o,i){var a,s,l,u=8*i-o-1,c=(1<<u)-1,d=c>>1,f=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:i-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+d>=1?f/l:f*Math.pow(2,1-d))*l>=2&&(a++,l/=2),a+d>=c?(s=0,a=c):a+d>=1?(s=(e*l-1)*Math.pow(2,o),a+=d):(s=e*Math.pow(2,d-1)*Math.pow(2,o),a=0));o>=8;t[n+h]=255&s,h+=p,s/=256,o-=8);for(a=a<<o|s,u+=o;u>0;t[n+h]=255&a,h+=p,a/=256,u-=8);t[n+h-p]|=128*g}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){for(var r=n(14),o=[],i={},a=0;a<256;a++)o[a]=(a+256).toString(16).substr(1),i[o[a]]=a;function s(t,e){var n=e||0,r=o;return r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]}var l=r(),u=[1|l[0],l[1],l[2],l[3],l[4],l[5]],c=16383&(l[6]<<8|l[7]),d=0,f=0;function h(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"==t?new Array(16):null,t=null);var i=(t=t||{}).random||(t.rng||r)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e)for(var a=0;a<16;a++)e[o+a]=i[a];return e||s(i)}var p=h;p.v1=function(t,e,n){var r=e&&n||0,o=e||[],i=void 0!==(t=t||{}).clockseq?t.clockseq:c,a=void 0!==t.msecs?t.msecs:(new Date).getTime(),l=void 0!==t.nsecs?t.nsecs:f+1,h=a-d+(l-f)/1e4;if(h<0&&void 0===t.clockseq&&(i=i+1&16383),(h<0||a>d)&&void 0===t.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");d=a,f=l,c=i;var p=(1e4*(268435455&(a+=122192928e5))+l)%4294967296;o[r++]=p>>>24&255,o[r++]=p>>>16&255,o[r++]=p>>>8&255,o[r++]=255&p;var g=a/4294967296*1e4&268435455;o[r++]=g>>>8&255,o[r++]=255&g,o[r++]=g>>>24&15|16,o[r++]=g>>>16&255,o[r++]=i>>>8|128,o[r++]=255&i;for(var m=t.node||u,y=0;y<6;y++)o[r+y]=m[y];return e||s(o)},p.v4=h,p.parse=function(t,e,n){var r=e&&n||0,o=0;for(e=e||[],t.toLowerCase().replace(/[0-9a-f]{2}/g,function(t){o<16&&(e[r+o++]=i[t])});o<16;)e[r+o++]=0;return e},p.unparse=s,t.exports=p},function(t,e,n){(function(e){var n,r=e.crypto||e.msCrypto;if(r&&r.getRandomValues){var o=new Uint8Array(16);n=function(){return r.getRandomValues(o),o}}if(!n){var i=new Array(16);n=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}t.exports=n}).call(this,n(6))},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var o=n(1),i=n.n(o),a=n(0),s=n.n(a),l=n(2),u=n.n(l),c=(n(15),n(7)),d=n.n(c);function f(t,e){var n,r,o=!1,i=u.a.nice(),a=null,l="right",c=null,h=null;return"function"==typeof e?n=e:(n=(e=e||{}).onOpen,r=e.onClose),"rootElement"in e&&(a=e.rootElement),"pos"in e&&(c=e.pos),"orientation"in e&&(l=e.orientation),"parentStart"in e&&(h=e.parentStart),s.a.selectAll(".d3-context-menu-"+i).data([1]).enter().append("div").classed("d3-context-menu",!0).classed("d3-context-menu-"+i,!0),s.a.select("body").on("click.d3-context-menu-"+i,function(){o?o=!1:(console.log("body click close"),s.a.select(".d3-context-menu-"+i).style("display","none"),l="right",r&&r())}),function(e,u){var p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],this),m=null,y=this;m=null==a?s.a.mouse(this):s.a.mouse(a);var v=null;o=p,s.a.selectAll(".d3-context-menu-"+i).html("");var b=s.a.selectAll(".d3-context-menu-"+i).on("contextmenu",function(t){console.log("context-menu close"),s.a.select(".d3-context-menu-"+i).style("display","none"),l="right",s.a.event.preventDefault(),s.a.event.stopPropagation()}).append("ul");if(b.selectAll("li").data("function"==typeof t?t(e):t).enter().append("li").attr("class",function(t){console.log("d:",t);var e="";return t.divider&&(e+=" is-divider"),t.disabled&&(e+=" is-disabled"),t.action||(e+=" is-header"),"children"in t&&(e+=" d3-context-menu-recursive"),e}).html(function(t){return t.divider?"<hr>":(t.title||console.error("No title attribute set. Check the spelling of your options."),"string"==typeof t.title?t.title:t.title(e))}).on("click",function(t,n){t.disabled||t.action&&(t.action(g,e,u,m),console.log("click close"),s.a.selectAll(".d3-context-menu").style("display","none"),l="right",r&&r())}).on("mouseenter",function(t,n){if(s.a.select(this).classed("d3-context-menu-selected",!0),null!=v){if(s.a.select(".d3-context-menu-"+i).selectAll("li").classed("d3-context-menu-selected",!1),void 0===t.children)return console.log("no children close"),s.a.select(".d3-context-menu-"+v).style("display","none"),void(v=null);if(t.childUid==v)return;console.log("open different child menu close"),s.a.select(".d3-context-menu-"+v).style("display","none"),v=null}if(void 0!==t.children){var r=this.getBoundingClientRect(),o=null;o=f(t.children,"left"==l?{rootElement:y,pos:[r.left+window.pageXOffset,r.top-2+window.pageYOffset],orientation:"left"}:{pos:[r.left+r.width+window.pageXOffset,r.top-2+window.pageYOffset],rootElement:y,parentStart:[r.left+window.pageXOffset,r.top-2+window.pageYOffset]}),t.childUid=o.apply(this,[e,n,!0,function(){}]),v=t.childUid}s.a.select(this).classed("d3-context-menu-selected",!0)}).on("mouseleave",function(t,e){null==v&&s.a.select(this).classed("d3-context-menu-selected",!1)}),b.selectAll(".d3-context-menu-recursive").append("img").attr("src",d.a).attr("width","14px").attr("height","14px").style("position","absolute").style("right","5px"),n&&!1===n(e,u))return i;var k=s.a.select(".d3-context-menu-"+i).style("display","block");null==c?s.a.select(".d3-context-menu-"+i).style("left",s.a.event.pageX-2+"px").style("top",s.a.event.pageY-2+"px"):s.a.select(".d3-context-menu-"+i).style("left",c[0]+"px").style("top",c[1]+"px");var x=k.node().getBoundingClientRect();return(x.left+x.width>window.innerWidth||"left"==l)&&(l="left",null==c?s.a.select(".d3-context-menu-"+i).style("left",s.a.event.pageX-2-x.width+"px").style("top",s.a.event.pageY-2+"px"):null!=h?s.a.select(".d3-context-menu-"+i).style("left",h[0]-x.width+"px").style("top",h[1]+"px"):s.a.select(".d3-context-menu-"+i).style("left",c[0]-x.width+"px").style("top",c[1]+"px")),o?i:(s.a.event.preventDefault(),s.a.event.stopPropagation(),i)}}var h=function(t,e){return t-e};function p(){var t=this;t.bracketLeft="([{<ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),t.bracketRight=")]}>abcdefghijklmnopqrstuvwxyz".split(""),t.inverseBrackets=function(t){for(var e={},n=0;n<t.length;n++)e[t[n]]=n;return e},t.maximumMatching=function(t){for(var e=t[0],n=new Array(e+1),r=0;r<=e;r++){n[r]=new Array(e+1);for(var o=r;o<=e;o++)n[r][o]=0}var i=0;for(r=e-0-1;r>0;r--)for(o=r+0+1;o<=e;o++){i=n[r][o-1];for(var a=o-0-1;a>=r;a--)t[a]===o&&(i=Math.max(i,(a>r?n[r][a-1]:0)+1+(o-a-1>0?n[a+1][o-1]:0)));n[r][o]=i}return i=n[1][e],n},t.backtrackMaximumMatching=function(e,n){var r=Array.apply(null,Array(e.length)).map(function(){return 0});return t.mmBt(e,r,n,1,e.length-1),r},t.mmBt=function(e,n,r,o,i){var a=e[o][i];if(!(i-o-1<0))if(e[o][i-1]!=a){for(var s=i-0-1;s>=o;s--)if(r[i]===s&&(s>o?e[o][s-1]:0)+(i-s-1>0?e[s+1][i-1]:0)+1==a)return n[s]=i,n[i]=s,o<s&&t.mmBt(e,n,r,o,s-1),void t.mmBt(e,n,r,s+1,i-1);console.log("FAILED!!!"+o+","+i+": backtracking failed!")}else t.mmBt(e,n,r,o,i-1)},t.dotbracketToPairtable=function(e){var n=Array.apply(null,new Array(e.length+1)).map(Number.prototype.valueOf,0);n[0]=e.length;for(var r={},o=0;o<t.bracketLeft.length;o++)r[o]=[];var i=t.inverseBrackets(t.bracketLeft),a=t.inverseBrackets(t.bracketRight);for(o=0;o<e.length;o++){var s=e[o],l=o+1;if("."==s||"o"==s)n[l]=0;else if(s in i)r[i[s]].push(l);else{if(!(s in a))throw"Unknown symbol in dotbracket string";var u=r[a[s]].pop();n[l]=u,n[u]=l}}for(var c in r)if(r[c].length>0)throw"Unmatched base at position "+r[c][0];return n},t.insertIntoStack=function(t,e,n){for(var r=0;t[r].length>0&&t[r][t[r].length-1]<n;)r+=1;return t[r].push(n),r},t.deleteFromStack=function(t,e){for(var n=0;0===t[n].length||t[n][t[n].length-1]!=e;)n+=1;return t[n].pop(),n},t.pairtableToDotbracket=function(e){for(var n={},r=0;r<e[0];r++)n[r]=[];var o={},i="";for(r=1;r<e[0]+1;r++){if(0!==e[r]&&e[r]in o)throw"Invalid pairtable contains duplicate entries";o[e[r]]=!0,0===e[r]?i+=".":e[r]>r?i+=t.bracketLeft[t.insertIntoStack(n,r,e[r])]:i+=t.bracketRight[t.deleteFromStack(n,r)]}return i},t.findUnmatched=function(e,n,r){for(var o=[],i=[],a=n,s=r,l=n;l<=r;l++)0!==e[l]&&(e[l]<n||e[l]>r)&&i.push([l,e[l]]);for(l=a;l<=s;l++){for(;0===e[l]&&l<=s;)l++;for(r=e[l];e[l]===r;)l++,r--;o=o.concat(t.findUnmatched(e,l,r))}return i.length>0&&o.push(i),o},t.removePseudoknotsFromPairtable=function(e){for(var n=t.maximumMatching(e),r=t.backtrackMaximumMatching(n,e),o=[],i=1;i<e.length;i++)e[i]<i||r[i]!=e[i]&&(o.push([i,e[i]]),e[e[i]]=0,e[i]=0);return o},t.ptToElements=function(e,n,r,o,i){var a=[],s=[r-1],l=[o+1];if(arguments.length<5&&(i=[]),r>o)return[];for(;0===e[r];r++)s.push(r);for(;0===e[o];o--)l.push(o);if(r>o){if(s.push(r),0===n)return[["e",n,s.sort(h)]];for(var u=!1,c=[],d=[],f=0;f<s.length;f++)u?d.push(s[f]):c.push(s[f]),i.indexOf(s[f])>=0&&(u=!0);return[["h",n,s.sort(h)]]}if(e[r]!=o){var p=s;for(f=r,p.push(f);f<=o;){for(a=a.concat(t.ptToElements(e,n,f,e[f],i)),p.push(e[f]),f=e[f]+1;0===e[f]&&f<=o;f++)p.push(f);p.push(f)}return p.pop(),(p=p.concat(l)).length>0&&(0===n?a.push(["e",n,p.sort(h)]):a.push(["m",n,p.sort(h)])),a}e[r]===o&&(s.push(r),l.push(o),s.concat(l).length>4&&(0===n?a.push(["e",n,s.concat(l).sort(h)]):a.push(["i",n,s.concat(l).sort(h)])));for(var g=[];e[r]===o&&r<o;)g.push(r),g.push(o),r+=1,o-=1,n+=1;return s=[r-1],l=[o+1],a.push(["s",n,g.sort(h)]),a.concat(t.ptToElements(e,n,r,o,i))}}var g=new p;function m(t){var e=this;return e.colorsText=t,e.parseRange=function(t){for(var e=t.split(","),n=[],r=0;r<e.length;r++){var o=e[r].split("-");if(1==o.length)n.push(parseInt(o[0]));else if(2==o.length)for(var i=parseInt(o[0]),a=parseInt(o[1]),s=i;s<=a;s++)n.push(s);else console.log("Malformed range (too many dashes):",t)}return n},e.parseColorText=function(t){for(var n=t.split("\n"),r="",o=1,i={colorValues:{"":{}},range:["white","steelblue"]},a=[],s=0;s<n.length;s++)if(">"!=n[s][0])for(var l=n[s].trim().split(/[\s]+/),u=0;u<l.length;u++)if(isNaN(l[u])){if(0===l[u].search("range")){var c=l[u].split("=")[1].split(":");i.range=[c[0],c[1]];continue}if(0==l[u].search("domain")){var d=l[u].split("=")[1].split(":");i.domain=[d[0],d[1]];continue}for(var f=l[u].split(":"),h=e.parseRange(f[0]),p=f[1],g=0;g<h.length;g++)isNaN(p)?i.colorValues[r][h[g]]=p:(i.colorValues[r][h[g]]=+p,a.push(Number(p)))}else i.colorValues[r][o]=Number(l[u]),o+=1,a.push(Number(l[u]));else r=n[s].trim().slice(1),o=1,i.colorValues[r]={};return"domain"in i||(i.domain=[Math.min.apply(null,a),Math.max.apply(null,a)]),e.colorsJson=i,e},e.normalizeColors=function(){var t;for(var n in e.colorsJson){var r=Number.MAX_VALUE,o=Number.MIN_VALUE;for(var i in e.colorsJson.colorValues[n])"number"==typeof(t=e.colorsJson.colorValues[n][i])&&(t<r&&(r=t),t>o&&(o=t));for(i in e.colorsJson.colorValues[n])"number"==typeof(t=e.colorsJson.colorValues[n][i])&&(e.colorsJson.colorValues[n][i]=(t-r)/(o-r))}return e},e.parseColorText(e.colorsText),e}var y=function(t,e){return t-e};function v(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=this;o.type="rna",o.circularizeExternal=!1,o.seq=t,o.dotbracket=e,o.structName=n,o.circular=!1,"*"==o.dotbracket.slice(-1)&&(o.dotbracket=o.dotbracket.slice(0,-1),o.circular=!0),o.uid=u.a.nice(),o.elements=[],o.pseudoknotPairs=[],o.nucsToNodes={},o.addUids=function(t){for(var e=o.nodes.filter(function(t){return"nucleotide"==t.nodeType}),n=0;n<t.length&&n<e.length;n++)e[n].uid=t[n];return o},o.computePairtable=function(){o.pairtable=g.dotbracketToPairtable(o.dotbracket)},o.removeBreaks=function(t){for(var e=[],n=-1;(n=t.indexOf("&"))>=0;)e.push(n),t=t.substring(0,n)+t.substring(n+1,t.length);return{targetString:t,breaks:e}};var i=o.removeBreaks(o.dotbracket);o.dotbracket=i.targetString,o.dotBracketBreaks=i.breaks,i=o.removeBreaks(o.seq),o.seq=i.targetString,o.seqBreaks=i.breaks,o.rnaLength=o.dotbracket.length,function(t,e){if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!=e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(o.dotBracketBreaks,o.seqBreaks)||(console.log("WARNING: Sequence and structure breaks not equal"),console.log("WARNING: Using the breaks in the structure")),o.computePairtable(),o.addPositions=function(t,e){for(var n=o.nodes.filter(function(e){return e.nodeType==t}),r=0;r<n.length;r++)n[r].x=e[r][0],n[r].y=e[r][1];return o},o.breakNodesToFakeNodes=function(){for(var t=o.nodes.filter(function(t){return"nucleotide"==t.nodeType}),e=0;e<t.length;e++)o.dotBracketBreaks.indexOf(e)>=0&&(t[e].nodeType="middle",t[e+1].nodeType="middle");for(var n=function(t){i=!1;for(var e=0;e<o.elements[t][2].length;e++)o.dotBracketBreaks.indexOf(o.elements[t][2][e])>=0&&(i=!0);i?o.elements[t][2].map(function(t){0!=t&&(o.nodes[t-1].elemType="e")}):o.elements[t][2].map(function(e){0!=e&&(o.nodes[e-1].elemType=o.elements[t][0])})},r=0;r<o.elements.length;r++){var i;n(r)}return o},o.getPositions=function(t){for(var e=[],n=o.nodes.filter(function(e){return e.nodeType==t}),r=0;r<n.length;r++)e.push([n[r].x,n[r].y]);return e},o.getUids=function(){for(var t=[],e=0;e<o.dotbracket.length;e++)t.push(o.nodes[e].uid);return t},o.reinforceStems=function(){for(var t=o.pairtable,e=o.elements.filter(function(t){return"s"==t[0]&&t[2].length>=4}),n=0;n<e.length;n++)for(var r=e[n][2],i=r.slice(0,r.length/2),a=0;a<i.length-1;a++)o.addFakeNode([i[a],i[a+1],t[i[a+1]],t[i[a]]]);return o},o.reinforceLoops=function(){for(var t=function(t){return 0!==t&&t<=o.dotbracket.length},e=0;e<o.elements.length;e++)if("s"!=o.elements[e][0]&&(o.circularizeExternal||"e"!=o.elements[e][0])){var n=o.elements[e][2].filter(t);if("e"==o.elements[e][0]){var r={name:"",num:-3,radius:0,rna:o,nodeType:"middle",elemType:"f",nucs:[],x:o.nodes[o.rnaLength-1].x,y:o.nodes[o.rnaLength-1].y,px:o.nodes[o.rnaLength-1].px,py:o.nodes[o.rnaLength-1].py,uid:u.a.nice()},i={name:"",num:-2,radius:0,rna:o,nodeType:"middle",elemType:"f",nucs:[],x:o.nodes[0].x,y:o.nodes[0].y,px:o.nodes[0].px,py:o.nodes[0].py,uid:u.a.nice()};n.push(o.nodes.length+1),n.push(o.nodes.length+2),o.nodes.push(r),o.nodes.push(i)}o.addFakeNode(n)}return o},o.updateLinkUids=function(){for(var t=0;t<o.links.length;t++)o.links[t].uid=o.links[t].source.uid+o.links[t].target.uid;return o},o.addFakeNode=function(t){for(var e=6.283/(2*t.length),n=18/(2*Math.tan(e)),r="",i=0;i<t.length;i++)r+=o.nodes[t[i]-1].uid;var a={name:"",num:-1,radius:n,rna:o,nodeType:"middle",elemType:"f",nucs:t,uid:r};o.nodes.push(a);var s=0,l=0,c=0;e=3.14159*(t.length-2)/(2*t.length),n=.5/Math.cos(e);for(var d=0;d<t.length;d++)if(!(0===t[d]||t[d]>o.dotbracket.length)){o.links.push({source:o.nodes[t[d]-1],target:o.nodes[o.nodes.length-1],linkType:"fake",value:n,uid:u.a.nice()}),t.length>4&&o.links.push({source:o.nodes[t[d]-1],target:o.nodes[t[(d+Math.floor(t.length/2))%t.length]-1],linkType:"fake",value:2*n,uid:u.a.nice()});var f=3.14159*(t.length-2)/t.length,h=2*Math.cos(1.570795-f/2);o.links.push({source:o.nodes[t[d]-1],target:o.nodes[t[(d+2)%t.length]-1],linkType:"fake",value:h});var p=o.nodes[t[d]-1];"x"in p&&(s+=p.x,l+=p.y,c+=1)}return c>0&&(a.x=s/c,a.y=l/c,a.px=a.x,a.py=a.y),o},o.connectFakeNodes=function(){for(var t={},e=o.nodes.filter(function(t){return"middle"==t.nodeType}),n={},r=1;r<=o.nodes.length;r++)t[r]=[];for(r=0;r<e.length;r++)for(var i=e[r],a=0;a<i.nucs.length;a++){for(var s=i.nucs[a],l=0;l<t[s].length;l++)if(!(JSON.stringify([t[s][l].uid,i.uid].sort())in n)){var u=t[s][l].radius+i.radius;o.links.push({source:t[s][l],target:i,value:u/18,linkType:"fake_fake"}),n[JSON.stringify([t[s][l].uid,i.uid].sort())]=!0}t[s].push(i)}return o},o.addExtraLinks=function(t){if(void 0===t)return o;for(var e=0;e<t.length;e++){var n={source:o.getNodeFromNucleotides(t[e].from),target:o.getNodeFromNucleotides(t[e].to),linkType:"extra",extraLinkType:t[e].linkType,uid:u.a.nice()};o.links.push(n)}return o},o.elementsToJson=function(){var t=o.pairtable;o.elements,o.nodes=[],o.links=[];var e={};o.elements.sort();for(var n=0;n<o.elements.length;n++)for(var i=o.elements[n][2],a=0;a<i.length;a++)e[i[a]]=o.elements[n][0];for(var s=1;s<=t[0];s++){var l=o.seq[s-1];(o.dotBracketBreaks.indexOf(s-1)>=0||o.dotBracketBreaks.indexOf(s-2)>=0)&&(l=""),o.nodes.push({name:l,num:r+s-1,radius:5,rna:o,nodeType:"nucleotide",structName:o.structName,elemType:e[s],uid:u.a.nice(),linked:!1})}for(var c=0;c<o.nodes.length;c++)o.nodes[c].prevNode=0===c?null:o.nodes[c-1],c==o.nodes.length-1?o.nodes[c].nextNode=null:o.nodes[c].nextNode=o.nodes[c+1];for(var d=1;d<=t[0];d++)0!==t[d]&&o.links.push({source:o.nodes[d-1],target:o.nodes[t[d]-1],linkType:"basepair",value:1,uid:u.a.nice()}),d>1&&-1===o.dotBracketBreaks.indexOf(d-1)&&-1==o.dotBracketBreaks.indexOf(d-2)&&-1==o.dotBracketBreaks.indexOf(d-3)&&(o.links.push({source:o.nodes[d-2],target:o.nodes[d-1],linkType:"backbone",value:1,uid:u.a.nice()}),o.nodes[d-1].linked=!0);for(var f=0;f<o.pseudoknotPairs.length;f++)o.links.push({source:o.nodes[o.pseudoknotPairs[f][0]-1],target:o.nodes[o.pseudoknotPairs[f][1]-1],linkType:"pseudoknot",value:1,uid:u.a.nice()});return o.circular&&o.links.push({source:o.nodes[0],target:o.nodes[o.rnaLength-1],linkType:"backbone",value:1,uid:u.a.nice()}),o},o.ptToElements=function(t,e,n,r){var i=[],a=[n-1],s=[r+1];if(n>r)return[];for(;0===t[n];n++)a.push(n);for(;0===t[r];r--)s.push(r);if(n>r){if(a.push(n),0===e)return[["e",e,a.sort(y)]];for(var l=!1,u=[],c=[],d=0;d<a.length;d++)l?c.push(a[d]):u.push(a[d]),o.dotBracketBreaks.indexOf(a[d])>=0&&(l=!0);return[["h",e,a.sort(y)]]}if(t[n]!=r){var f=a;for(d=n,f.push(d);d<=r;){for(i=i.concat(o.ptToElements(t,e,d,t[d])),f.push(t[d]),d=t[d]+1;0===t[d]&&d<=r;d++)f.push(d);f.push(d)}return f.pop(),(f=f.concat(s)).length>0&&(0===e?i.push(["e",e,f.sort(y)]):i.push(["m",e,f.sort(y)])),i}t[n]===r&&(a.push(n),s.push(r),a.concat(s).length>4&&(0===e?i.push(["e",e,a.concat(s).sort(y)]):i.push(["i",e,a.concat(s).sort(y)])));for(var h=[];t[n]===r&&n<r;)h.push(n),h.push(r),n+=1,r-=1,e+=1;return a=[n-1],s=[r+1],i.push(["s",e,h.sort(y)]),i.concat(o.ptToElements(t,e,n,r))},o.addLabels=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(0===e)return o;for(var n=1;n<=o.rnaLength;n++)if(n%e==0){var r,i,a=o.nodes[n-1],s=void 0,l=void 0,c=void 0,d=void 0;1==o.rnaLength?(d=[a.x-15,a.y],c=[a.x-15,a.y]):(s=1==n?o.nodes[o.rnaLength-1]:o.nodes[n-2],l=n==o.rnaLength?o.nodes[0]:o.nodes[n],0!==o.pairtable[l.num-t+1]&&0!==o.pairtable[s.num-t+1]&&0!==o.pairtable[a.num-t+1]&&(s=l=o.nodes[o.pairtable[a.num-t+1]-1]),0===o.pairtable[a.num-t+1]||0!==o.pairtable[l.num-t+1]&&0!==o.pairtable[s.num-t+1]?(d=[l.x-a.x,l.y-a.y],c=[s.x-a.x,s.y-a.y]):(d=[a.x-l.x,a.y-l.y],c=[a.x-s.x,a.y-s.y]));var f=[d[0]+c[0],d[1]+c[1]],h=Math.sqrt(f[0]*f[0]+f[1]*f[1]),p=[f[0]/h,f[1]/h],g=[-15*p[0],-15*p[1]];r=o.nodes[n-1].x+g[0],i=o.nodes[n-1].y+g[1];var m={name:n+t-1,num:-1,radius:6,rna:o,nodeType:"label",structName:o.structName,elemType:"l",x:r,y:i,px:r,py:i,uid:u.a.nice()},y={source:o.nodes[n-1],target:m,value:1,linkType:"label_link",uid:u.a.nice()};o.nodes.push(m),o.links.push(y)}return o},o.recalculateElements=function(){if(o.removePseudoknots(),o.elements=o.ptToElements(o.pairtable,0,1,o.dotbracket.length),o.circular){var t=o.elements.filter(function(t){if("e"==t[0])return!0});if(t.length>0){eloop=t[0],nucs=eloop[2].sort(y),prev=nucs[0],hloop=!0,numGreater=0;for(var e=1;e<nucs.length;e++)nucs[e]-prev>1&&(numGreater+=1),prev=nucs[e];1==numGreater?eloop[0]="h":2==numGreater?eloop[0]="i":eloop[0]="m"}}return o},o.reassignLinkUids=function(){for(var t=0;t<o.links.length;t++)o.links[t].uid=o.links[t].source.uid+o.links[t].target.uid;return o},o.removePseudoknots=function(){return o.pairtable.length>1&&(o.pseudoknotPairs=o.pseudoknotPairs.concat(g.removePseudoknotsFromPairtable(o.pairtable))),o},o.addPseudoknots=function(){for(var t=o.pairtable,e=o.pseudoknotPairs,n=0;n<e.length;n++)t[e[n][0]]=e[n][1],t[e[n][1]]=e[n][0];return o.pseudoknotPairs=[],o},o.addName=function(t){return void 0===t?(o.name="",o):(o.name=t,o)},o.rnaLength>0&&o.recalculateElements(),o.getNodeFromNucleotides=function(t){if("[object Array]"===Object.prototype.toString.call(t)){for(var e=0;e<o.nodes.length;e++)if("nucs"in o.nodes[e]&&o.nodes[e].nucs.equals(t))return o.nodes[e]}else for(var n=0;n<o.nodes.length;n++)if(o.nodes[n].num==t)return o.nodes[n];return console.log("ERROR: No node found for nucs:",t),null}}function b(t){var e,n,r,o=[],i=[];n=t[0];var a=Array.apply(null,new Array(n+5)).map(Number.prototype.valueOf,0),s=Array.apply(null,new Array(16+Math.floor(n/5))).map(Number.prototype.valueOf,0),l=Array.apply(null,new Array(16+Math.floor(n/5))).map(Number.prototype.valueOf,0),u=0,c=0,d=Math.PI/2;!function t(e,n,r){var o,i,f,h,p,g,m,y,v,b,k,x,w=2,A=0,E=0,_=Array.apply(null,new Array(3+2*Math.floor((n-e)/5))).map(Number.prototype.valueOf,0);for(o=e-1,n++;e!=n;)if((i=r[e])&&0!=e){w+=2,f=e,h=i,_[++A]=f,_[++A]=h,e=i+1,p=f,g=h,y=0;do{f++,h--,y++}while(r[f]==h&&r[f]>f);if(m=y-2,y>=2&&(a[p+1+m]+=d,a[g-1-m]+=d,a[p]+=d,a[g]+=d,y>2))for(;m>=1;m--)a[p+m]=Math.PI,a[g-m]=Math.PI;l[++c]=y,f<=h&&t(f,h,r)}else e++,w++,E++;for(x=Math.PI*(w-2)/w,_[++A]=n,v=o<0?0:o,b=1;b<=A;b++){for(k=_[b]-v,m=0;m<=k;m++)a[v+m]+=x;if(b>A)break;v=_[++b]}s[++u]=E}(0,n+1,t),s[u]-=2,r=0,o[0]=100,i[0]=100;var f=[];for(f.push([o[0],i[0]]),e=1;e<n;e++)o[e]=o[e-1]+15*Math.cos(r),i[e]=i[e-1]+15*Math.sin(r),f.push([o[e],i[e]]),r+=Math.PI-a[e+1];return f}function k(){this.radius=null,this.loopnumber=null,this.next=null,this.prev=null}void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}),k.prototype.getRadius=function(){return this.radius},k.prototype.setRadius=function(t){this.radius=t},k.prototype.getLoopnumber=function(){return this.loopnumber},k.prototype.setLoopnumber=function(t){this.loopnumber=t},k.prototype.getNext=function(){return this.next},k.prototype.setNext=function(t){this.next=t},k.prototype.getPrev=function(){return this.prev},k.prototype.setPrev=function(t){this.prev=t};var x=n(3),w=n(5);function A(){this.mate=null,this.x=null,this.y=null,this.extracted=null,this.region=new w.a}A.prototype.getMate=function(){return this.mate},A.prototype.setMate=function(t){this.mate=t},A.prototype.getX=function(){return this.x},A.prototype.setX=function(t){this.x=t},A.prototype.getY=function(){return this.y},A.prototype.setY=function(t){this.y=t},A.prototype.isExtracted=function(){return this.extracted},A.prototype.setExtracted=function(t){this.extracted=t},A.prototype.getRegion=function(){return this.region},A.prototype.setRegion=function(t){this.region=t};var E=n(4);function _(){this.ANUM=9999,this.MAXITER=500,this.bases=[],this.nbase=null,this.nregion=null,this.loop_count=null,this.root=new E.a,this.loops=[],this.regions=[],this.rlphead=new k,this.lencut=.8,this.RADIUS_REDUCTION_FACTOR=1.4,this.angleinc=null,this._h=null,this.HELIX_FACTOR=.6,this.BACKBONE_DISTANCE=27}function N(t){var e=null,n=null,r=null;if(t.getNconnection()<=1)return 0;if(t.isMark())return-1;t.setMark(!0),e=0,n=0;for(var o=0;null!=t.getConnection(o);o++)(r=N(t.getConnection(o).getLoop()))>=0&&(1==++e?n=r:n>r&&(n=r));return t.setMark(!1),n+1}function L(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this;n.options=Object.assign({editable:!1,zoomable:!0,animation:!0,displayAllLinks:!1,labelInterval:10,chargeDistance:110,friction:.35,middleCharge:-30,otherCharge:-30,linkDistanceMultiplier:15,initialSize:null,layout:"standard-polygonal",transitionDuration:500,maxNodeRadius:80},e),null!==n.options.initialSize?(n.options.svgW=n.options.initialSize[0],n.options.svgH=n.options.initialSize[1]):(n.options.svgW=300,n.options.svgH=300),n.linkStrengths={pseudoknot:0,proteinChain:0,chainChain:0,intermolecule:10,external:0,other:10},n.displayParameters={displayNumbering:!0,displayNodeOutline:!0,displayNodeLabel:!0,displayLinks:!0,displayPseudoknotLinks:!0,displayProteinLinks:!0,displayDirectionArrows:!0},n.colorScheme="structure",n.customColors={},n.rnas={},n.extraLinks=[];var o=null,a=null,l=!1,c=function(){o=null,a=null},d=n.graph={nodes:[],links:[]};if(Array.prototype.equals=function(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var e=0,n=this.length;e<n;e++)if(this[e]instanceof Array&&t[e]instanceof Array){if(!this[e].equals(t[e]))return!1}else if(this[e]!=t[e])return!1;return!0},n.options.editable||n.options.animation){var h=!1,p=!1;s.a.select("body").on("keydown",function(){switch(s.a.event.keyCode){case 68:console.log("dotbracket:",n.getStructuresDotBracket());break;case 16:h=!0;break;case 17:p=!0;break;case 67:n.centerView()}p&&(n.options.zoomable&&S(),(n.options.editable||n.options.animation)&&Y())}).on("keyup",function(){h=!1,p=!1,n.options.zoomable&&M(),B()}).on("contextmenu",function(){s.a.event.preventDefault()})}if(n.options.editable){var y=[{title:"Add Node",action:function(t,e,n,r){},children:[{title:"A",action:function(t,e,r,o){console.log("mousePos:",o,n.options.svgW,n.options.svgH);var i=[P.invert(o[0]),T.invert(o[1])];console.log("canvasMousePos",i),n.addRNA(".",{sequence:"A",centerPos:i})}},{title:"C",action:function(t,e,r,o){console.log("mousePos:",o,n.options.svgW,n.options.svgH);var i=[P.invert(o[0]),T.invert(o[1])];console.log("canvasMousePos",i),n.addRNA(".",{sequence:"C",centerPos:i})}},{title:"G",action:function(t,e,r,o){console.log("mousePos:",o,n.options.svgW,n.options.svgH);var i=[P.invert(o[0]),T.invert(o[1])];console.log("canvasMousePos",i),n.addRNA(".",{sequence:"G",centerPos:i})}},{title:"U",action:function(t,e,r,o){console.log("mousePos:",o,n.options.svgW,n.options.svgH);var i=[P.invert(o[0]),T.invert(o[1])];console.log("canvasMousePos",i),n.addRNA(".",{sequence:"U",centerPos:i})}}],disabled:!1}],k=[{title:"Delete Node",action:function(t,e,n){W(e)},disabled:!1},{title:"Change Node",action:function(t,e,n){console.log("You have clicked the second item!"),console.log("The data for this circle is: "+e)},children:[{title:"A",action:function(t,e,n){V("A",e)}},{title:"C",action:function(t,e,n){V("C",e)}},{title:"G",action:function(t,e,n){V("G",e)}},{title:"U",action:function(t,e,n){V("U",e)}}]},{title:"Insert Before",action:function(t,e,n){},children:[{title:"A",action:function(t,e,n){H("A",e,-1)}},{title:"C",action:function(t,e,n){H("C",e,-1)}},{title:"G",action:function(t,e,n){H("G",e,-1)}},{title:"U",action:function(t,e,n){H("U",e,-1)}}]},{title:"Insert After",action:function(t,e,n){console.log("d:",e)},children:[{title:"A",action:function(t,e,n){H("A",e,0)}},{title:"C",action:function(t,e,n){H("C",e,0)}},{title:"G",action:function(t,e,n){H("G",e,0)}},{title:"U",action:function(t,e,n){H("U",e,0)}}]}];n.nodeContextMenu=f(k),n.backgroundContextMenu=f(y)}else n.nodeContextMenu=function(){};s.a.select(t).select("svg").remove();var x=s.a.select(t).attr("tabindex",1).each(function(){this.focus()}).append("svg:svg").attr("preserveAspectRatio","xMidYMid meet").attr("viewBox","0 0 "+n.options.svgW+" "+n.options.svgH);if(n.options.svg=x,n.options.editable||n.options.animation)(w=x.append("svg:g").on("mousemove",function(){if(o){var t=s.a.mouse(A.node());L.attr("x1",o.x).attr("y1",o.y).attr("x2",t[0]).attr("y2",t[1])}}).on("mousedown",function(){}).on("mouseup",function(){o&&!l&&L.classed(i.a.transparent,!0),c()}).classed(i.a.mouseEventHelper,!0).style("pointer-events","all")).append("svg:rect").classed("background",!0).style("visibility","hidden").attr("width",n.options.svgW).attr("height",n.options.svgH).on("mousedown",function(){C()});else var w=x;var A=w.append("svg:g").classed(i.a.plot,!0),E=A.append("svg:g").classed("fornac-links",!0),N=A.append("svg:g").classed("fornac-nodes",!0);if(n.options.editable){var L=A.append("line").attr("class",i.a.dragLine).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0);x.on("contextmenu",n.backgroundContextMenu)}var P=s.a.scale.linear().domain([0,n.options.svgW]).range([0,n.options.svgW]),T=s.a.scale.linear().domain([0,n.options.svgH]).range([0,n.options.svgH]);n.zoomer=s.a.behavior.zoom().scaleExtent([.1,10]).x(P).y(T).on("zoom",function(){A.attr("transform","translate("+s.a.event.translate+") scale("+s.a.event.scale+")")});var M=function(){x.call(n.zoomer).on("dblclick.zoom",null)},S=function(){x.call(n.zoomer).on("dblclick.zoom",null).on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null)};n.options.zoomable&&M();var R=function(t){t.selected=!t.selected,N.selectAll("g.gnode").filter(function(e){return t.uid==e.uid}).classed(i.a.selectedNode,function(t){return t.selected})},C=function(){N.selectAll("g.gnode").classed(i.a.selectedNode,function(t){return t.selected=!1})},I=function(){return N.selectAll("g.gnode").filter(function(t){return t.selected})};n.brusher=s.a.svg.brush().x(P).y(T).on("brushstart",function(t){}).on("brush",function(){var t=s.a.event.target.extent();N.selectAll("g.gnode").classed(i.a.selectedNode,function(e){return e.selected^(t[0][0]<=e.x&&e.x<t[1][0]&&t[0][1]<=e.y&&e.y<t[1][1])})}).on("brushend",function(){var t=s.a.event.target.extent();N.selectAll("g.gnode").filter(function(e){return t[0][0]<=e.x&&e.x<t[1][0]&&t[0][1]<=e.y&&e.y<t[1][1]}).each(R),s.a.event.target.clear(),s.a.select(this).call(s.a.event.target)});var Y=function(){w.select(".background").style("cursor","crosshair"),w.call(n.brusher)},B=function(){w.select(".background").style("cursor","auto"),w.call(n.brusher).on("mousedown.brush",null).on("touchstart.brush",null).on("touchmove.brush",null).on("touchend.brush",null)};n.force=s.a.layout.force().charge(function(t){return"middle"==t.nodeType?n.options.middleCharge:n.options.otherCharge}).friction(n.options.friction).linkDistance(function(t){return n.options.linkDistanceMultiplier*t.value}).linkStrength(function(t){return t.linkType in n.linkStrengths?n.linkStrengths[t.linkType]:n.linkStrengths.other}).gravity(0).nodes(n.graph.nodes).links(n.graph.links).chargeDistance(n.options.chargeDistance).size([n.options.svgW,n.options.svgH]);var O=s.a.behavior.drag().on("dragstart",function(t){console.log("dragstart"),s.a.event.sourceEvent.stopPropagation(),I().each(function(t){t.fixed|=2})}).on("drag",function(t){h||(I().each(function(t){t.x+=s.a.event.dx,t.y+=s.a.event.dy,t.px+=s.a.event.dx,t.py+=s.a.event.dy}),n.resumeForce(),s.a.event.sourceEvent.preventDefault())}).on("dragend",function(t){console.log("dragend"),I().each(function(t){t.fixed&=-7})}),U=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={sequence:"",name:"empty",positions:[],labelInterval:n.options.labelInterval,avoidOthers:!0,uids:[],circularizeExternal:!0},o=new v((r=Object.assign(r,e)).sequence,t,r.name);o.circularizeExternal=r.circularizeExternal;var i=o.recalculateElements();if(0===r.positions.length)if("naview"==n.options.layout){var a=(new _).naview_xy_coordinates(o.pairtable);r.positions=[];for(var s=0;s<a.nbase;s++)r.positions.push([a.x[s],a.y[s]])}else r.positions=b(i.pairtable);return i=i.elementsToJson().addUids(r.uids).addPositions("nucleotide",r.positions).addLabels(1,r.labelInterval).reinforceStems().reinforceLoops().connectFakeNodes().reassignLinkUids().breakNodesToFakeNodes()},X=function(t){(t=t.append("g").classed("gnode",!0).attr("struct_name",function(t){return t.structName}).attr("transform",function(t){return void 0!==t.x&&void 0!==t.y?"translate("+[t.x,t.y]+")":""}).each(function(t){t.selected=t.previouslySelected=!1})).attr("num",function(t){return"n"+t.num}).attr("rnum",function(t){return"n"+(t.rna.rnaLength-t.num+1)}).transition().duration(750).ease("elastic"),(n.options.editable||n.options.animation)&&t.on("mousedown",Z).on("mouseup",K).on("contextmenu",n.nodeContextMenu).call(O);var e=t.filter(function(t){return"label"==t.nodeType||"protein"==t.nodeType}),r=t.filter(function(t){return"nucleotide"==t.nodeType});return e.append("svg:circle").classed(i.a.node,!0).attr("r",function(t){return"middle"==t.nodeType?0:t.radius}).attr("node_type",function(t){return t.nodeType}).attr("node_num",function(t){return t.num}),r.append("svg:path").attr("class",i.a.directionArrow).attr("node_num",function(t){return t.num}),r.append("svg:circle").attr("class",i.a.node).attr("node_type",function(t){return t.nodeType}).attr("node_num",function(t){return t.num}).attr("r",function(t){return t.radius}).append("svg:title").text(function(t){return"nucleotide"==t.nodeType?t.structName+":"+t.num:""}),t.append("text").text(function(t){return t.name}).attr("class",i.a.nodeLabel).attr("label_type",function(t){return t.nodeType}).append("svg:title").text(function(t){return"nucleotide"==t.nodeType?t.structName+":"+t.num:""}),t},D=function(t){var e=t.append("svg:line");return e.append("svg:title").text(function(t){return t.linkType+":"+t.source.num+"-"+t.target.num}),e.classed("link",!0).classed(i.a.link,!0).attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}).attr("link_type",function(t){return t.linkType}).attr("pointer-events",function(t){return"fake"==t.linkType?"none":"all"}),n.options.editable&&e.on("click",Q),e};function z(t){var e=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},n=t,r=t.prevNode,o=parseFloat(i.a.nodeStrokeWidth)/2,a=parseFloat(i.a.directionArrowSize),l=parseFloat(i.a.directionArrowWidth);if(null!==r&&t.linked){var u=[-(n.x-r.x),-(n.y-r.y)];if(0!=u[0]||0!=u[1]){var c=[-(u=[u[0]/e(u),u[1]/e(u)])[1],u[0]],d=[(t.radius+o)*u[0],(t.radius+o)*u[1]],f="M"+(d[0]+a*(u[0]/2+c[0]*l/2))+","+(d[1]+a*(u[1]/2+c[1]*l/2))+"L"+d[0]+","+d[1]+"L"+(d[0]+a*(u[0]/2-c[0]*l/2))+","+(d[1]+a*(u[1]/2-c[1]*l/2));s.a.select(this).attr("d",f)}}}var q=function(t){return"basepair"==t.linkType||"backbone"==t.linkType||"intermolecule"==t.linkType||"pseudoknot"==t.linkType||"label_link"==t.linkType||"external"==t.linkType||"chain_chain"==t.linkType},F=function(){for(var t in n.graph.nodes=[],n.graph.links=[],n.rnas)n.graph.nodes=n.graph.nodes.concat(n.rnas[t].nodes),n.graph.links=n.graph.links.concat(n.rnas[t].links);for(var e={},r=0;r<n.graph.nodes.length;r++)e[n.graph.nodes[r].uid]=n.graph.nodes[r];n.graph.links.forEach(function(t){t.source=e[t.source.uid],t.target=e[t.target.uid]});for(var o=function(t){if(!(n.extraLinks[t].target.uid in e))return console.log("not there:",n.extraLinks[t]),"continue";if(n.extraLinks[t].source=e[n.extraLinks[t].source.uid],n.extraLinks[t].target=e[n.extraLinks[t].target.uid],"intermolecule"==n.extraLinks[t].linkType)for(var r=n.graph.links.filter(function(e){return(e.source==n.extraLinks[t].source||e.source==n.extraLinks[t].target||e.target==n.extraLinks[t].source||e.target==n.extraLinks[t].source)&&"fake"==e.linkType}),o=0;o<r.length;o++){var i=n.graph.links.indexOf(r[o]);n.graph.links.splice(i,1)}d.links.push(n.extraLinks[t])},i=0;i<n.extraLinks.length;i++)o(i)};n.update=function(){n.force.nodes(n.graph.nodes).links(n.graph.links),n.options.animation&&n.force.start();var t=E.selectAll("line.link").data(n.graph.links.filter(q),J);t.attr("class","").classed("link",!0).classed(i.a.link,!0).attr("link_type",function(t){return t.linkType});var e=t.enter();D(e),t.exit().remove();var r=N.selectAll("g.gnode").data(n.graph.nodes,J),o=r.enter();X(o),r.exit().remove();var a=n.graph.nodes.filter(function(t){return"nucleotide"==t.nodeType||"label"==t.nodeType});r.select("."+i.a.directionArrow).each(z),n.force.on("tick",function(){for(var e=s.a.geom.quadtree(a),n=0,o=a.length,l=function(t){var e=t.radius+16,n=t.x-e,r=t.x+e,o=t.y-e,i=t.y+e;return function(e,a,s,l,u){if(e.point&&e.point!==t){var c=t.x-e.point.x,d=t.y-e.point.y,f=Math.sqrt(c*c+d*d),h=t.radius+e.point.radius;f<h&&(f=(f-h)/f*.1,t.x-=c*=f,t.y-=d*=f,e.point.x+=c,e.point.y+=d)}return a>r||l<n||s>i||u<o}};++n<o;)e.visit(l(a[n]));t.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),r.attr("transform",function(t){return"translate("+[t.x,t.y]+")"}),r.select("."+i.a.directionArrow).each(z)}),n.force.on("end",function(){r.selectAll("[node_type=nucleotide]").filter(function(t,e){return 0==e}).each(function(t,e){})}),n.changeColorScheme(n.colorScheme),n.options.animation&&n.force.start(),j()},n.transitionRNA=function(t,e){var r=n.options.transitionDuration,o=n.graph.nodes.filter(function(t){return"nucleotide"==t.nodeType}).map(function(t){return t.uid}),a=U(t,{uids:o}),s=N.selectAll("g.gnode").data(a.nodes,J),l=E.selectAll("line.link").data(a.links.filter(q),J);0===r?s.attr("transform",function(t){return"translate("+[t.x,t.y]+")"}):s.transition().attr("transform",function(t){return"translate("+[t.x,t.y]+")"}).duration(r);var u=X(s.enter()).attr("transform",function(t){return void 0!==t.x&&void 0!==t.y?"translate("+[0,0]+")":""});0===r?s.exit().remove():s.exit().transition().attr("transform",function(t){return void 0!==t.x&&void 0!==t.y?"translate("+[0,0]+")":""}),n.graph.nodes=s.data(),s.select("."+i.a.directionArrow).each(z),n.changeColorScheme(n.colorScheme),j(),n.centerView(r),l.exit().remove(),0===r?(l.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),D(l.enter()),n.graph.links=l.data(),j()):l.transition().attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}).duration(r).call(function(t,e){0===t.size()&&setTimeout(e,r);var n=0;t.each(function(){++n}).each("end",function(){--n||e.apply(this,arguments)})},function(){D(l.enter()),n.graph.links=l.data(),n.changeColorScheme(n.colorScheme),j(),void 0!==e&&e()}),0===r?u.attr("transform",function(t){return void 0!==t.x&&void 0!==t.y?"translate("+[t.x,t.y]+")":""}):u.transition().attr("transform",function(t){return void 0!==t.x&&void 0!==t.y?"translate("+[t.x,t.y]+")":""})},n.centerView=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=function(){if(0===n.graph.nodes.length)return{translate:[0,0],scale:1};var t=s.a.min(n.graph.nodes.map(function(t){return t.x})),e=s.a.min(n.graph.nodes.map(function(t){return t.y})),r=s.a.max(n.graph.nodes.map(function(t){return t.x})),o=s.a.max(n.graph.nodes.map(function(t){return t.y})),i=s.a.max(n.graph.nodes.map(function(t){return t.radius})),a=r-t,l=o-e,u=n.options.svgW/(a+1),c=n.options.svgH/(l+1),d=.8*Math.min(u,c,n.options.maxNodeRadius/i),f=a*d,h=l*d;return{translate:[-t*d+(n.options.svgW-f)/2,-e*d+(n.options.svgH-h)/2],scale:d}}();null!==e&&(A.transition().attr("transform","translate("+e.translate+") scale("+e.scale+")").duration(t),n.zoomer.translate(e.translate),n.zoomer.scale(e.scale))},n.setSize=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.a.select(t).node().offsetWidth,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.a.select(t).node().offsetHeight;n.options.svgW=e,n.options.svgH=r,x.attr("viewBox","0 0 "+e+" "+r),P.range([0,e]).domain([0,e]),T.range([0,r]).domain([0,r]),n.zoomer.x(P).y(T),n.brusher.x(P).y(T),x.select(".background").attr("width",e).attr("height",r),n.centerView()},n.setOutlineColor=function(t){N.selectAll("g.gnode").select("[node_type=nucleotide]").style("fill",t)},n.addCustomColors=function(t){n.customColors=t,n.changeColorScheme("custom")},n.addCustomColorsText=function(t){var e=new m(t);n.customColors=e.colorsJson,n.changeColorScheme("custom")},n.changeColorScheme=function(t){N.selectAll("[node_type=protein]").classed(i.a.node,!0).attr("r",function(t){return t.radius}),N.selectAll("g.gnode"),N.selectAll("g.gnode").selectAll("circle");var e=N.selectAll("g.gnode").select("[node_type=nucleotide]");if(n.colorScheme=t,"sequence"==t){var r=s.a.scale.ordinal().range(["#dbdb8d","#98df8a","#ff9896","#aec7e8","#aec7e8"]).domain(["A","C","G","U","T"]);e.style("fill",function(t){return r(t.name)})}else if("structure"==t)r=s.a.scale.category10().domain(["s","m","i","e","t","h","x"]).range(["lightgreen","#ff9896","#dbdb8d","lightsalmon","lightcyan","lightblue","transparent"]),e.style("fill",function(t){return r(t.elemType)});else if("positions"==t)e.style("fill",function(t){return s.a.scale.linear().range(["#98df8a","#dbdb8d","#ff9896"]).interpolate(s.a.interpolateLab).domain([1,1+(t.rna.rnaLength-1)/2,t.rna.rnaLength])(t.num)});else if("custom"==t){void 0!==n.customColors&&"domain"in n.customColors&&"range"in n.customColors&&(r=s.a.scale.linear().interpolate(s.a.interpolateLab).domain(n.customColors.domain).range(n.customColors.range));var o=function(t,e,n){if(t.hasOwnProperty(e.num)){var r=parseFloat(t[e.num]);return isNaN(r)?t[e.num]:n(r)}return"white"};e.style("fill",function(t){if(void 0===n.customColors||!n.customColors.hasOwnProperty("colorValues"))return"white";if(n.customColors.colorValues.hasOwnProperty(t.structName)&&n.customColors.colorValues[t.structName].hasOwnProperty(t.num)){var e=n.customColors.colorValues[t.structName];return o(e,t,r)}if(n.customColors.colorValues.hasOwnProperty("")){var i=n.customColors.colorValues[""];return o(i,t,r)}return"white"})}};var j=function(){N.selectAll("[node_type=label]").classed(i.a.transparent,!n.displayParameters.displayNumbering),N.selectAll("[label_type=label]").classed(i.a.transparent,!n.displayParameters.displayNumbering),E.selectAll("[link_type=label_link]").classed(i.a.transparent,!n.displayParameters.displayNumbering),x.selectAll("[node_type=nucleotide]").classed(i.a.transparent,!n.displayParameters.displayNodeOutline),N.selectAll("[label_type=nucleotide]").classed(i.a.transparent,!n.displayParameters.displayNodeLabel),x.selectAll("[link_type=real],[link_type=basepair],[link_type=backbone],[link_type=pseudoknot],[link_type=protein_chain],[link_type=chain_chain],[link_type=external]").classed(i.a.transparent,!n.displayParameters.displayLinks),x.selectAll("[link_type=pseudoknot]").classed(i.a.transparent,!n.displayParameters.displayPseudoknotLinks),x.selectAll("[link_type=protein_chain]").classed(i.a.transparent,!n.displayParameters.displayProteinLinks),E.selectAll("[link_type=fake]").classed(i.a.transparent,!n.options.displayAllLinks),E.selectAll("[link_type=fake_fake]").classed(i.a.transparent,!n.options.displayAllLinks),x.selectAll("."+i.a.directionArrow).classed(i.a.transparent,!n.displayParameters.displayDirectionArrows)},V=function(t,e){var r=e.rna,o=g.pairtableToDotbracket(r.pairtable),i=r.getPositions("nucleotide"),a=r.seq,s=r.getUids(),l=e.num,c=o,d=a.slice(0,l-1)+t+a.slice(l);console.log("newSequence:",d),console.log("uids:",s),s.splice(l-1,1,u.a.nice());var f=i;delete n.rnas[r.uid],n.addRNA(c,{sequence:d,positions:f,uids:s,centerView:!1})},H=function(t,e,r){var o=e.rna,i=g.pairtableToDotbracket(o.pairtable),a=o.getPositions("nucleotide"),s=o.seq,l=o.getUids(),c=e.num+r,d=i.slice(0,c)+"."+i.slice(c),f=s.slice(0,c)+t+s.slice(c);console.log("newSequence:",f),l.splice(c,0,u.a.nice()),a.splice(c,0,a[c-r-1]);var h=l,p=a;console.log("positions:",a),console.log("new node positions:",p),delete n.rnas[o.uid],n.addRNA(d,{sequence:f,positions:p,uids:h,centerView:!1})},W=function(t){console.log("deleting...",t);var e=t.rna,r=e.pairtable[t.num];0!=r&&(e.pairtable[t.num]=0,e.pairtable[r]=0);var o=g.pairtableToDotbracket(e.pairtable),i=e.getPositions("nucleotide"),a=e.seq,s=e.getUids(),l=o.slice(0,t.num-1)+o.slice(t.num),u=i.slice(0,t.num-1).concat(i.slice(t.num)),c=a.slice(0,t.num-1)+a.slice(t.num),d=s.slice(0,t.num-1).concat(s.slice(t.num));delete n.rnas[e.uid],n.addRNA(l,{sequence:c,positions:u,uids:d,centerView:!1}),console.log("new dotbracket:",l)},J=function(t){return t.uid},G=function(t){var e=t.getPositions("nucleotide"),r=t.getPositions("label"),o=t.getUids();t.recalculateElements().elementsToJson().addPseudoknots().addPositions("nucleotide",e).addUids(o).addLabels(1,n.options.labelInterval).addPositions("label",r).reinforceStems().reinforceLoops().updateLinkUids()},K=function(t,e){console.log("nodeMouseup");var r=!0;if(o){if("middle"==(a=t).nodeType||"middle"==o.nodeType||"label"==a.nodeType||"label"==o.nodeType)return;if(a==o)return void c();for(var s={source:o,target:a,linkType:"basepair",value:1,uid:u.a.nice()},d=0;d<n.graph.links.length;d++)if(n.graph.links[d].source!=o&&n.graph.links[d].target!=o&&n.graph.links[d].source!=a&&n.graph.links[d].target!=a||"basepair"!=n.graph.links[d].linkType&&"pseudoknot"!=n.graph.links[d].linkType&&"intermolecule"!=n.graph.links[d].linkType||(console.log("no basepair possible"),r=!1),(n.graph.links[d].source==a&&n.graph.links[d].target==o||n.graph.links[d].source==o&&n.graph.links[d].target==a)&&"backbone"==n.graph.links[d].linkType)return;if(s.source.rna!=s.target.rna)if(1==s.source.num&&s.target.num==s.target.rna.rnaLength||1==s.target.num&&s.source.num==s.source.rna.rnaLength){var h=[{title:"Backbone Link",action:function(t,e,r){l=!1,console.log("Item #1 clicked!"),console.log("The data for this circle is: "+e),L.attr("class",i.a.transparent),function(t){var e=t.target.rna,r=t.source.rna;1==t.target.num&&(e=t.source.rna,r=t.target.rna);for(var o=g.pairtableToDotbracket(e.pairtable),i=g.pairtableToDotbracket(r.pairtable),a=e.seq,s=r.seq,l=e.getPositions("nucleotide"),c=r.getPositions("nucleotide"),d=o+i,f=a+s,h=l.concat(c),p=[],m={},y=0;y<n.extraLinks.length;y++)console.log("self.extraLinks[i]",n.extraLinks[y]),console.log("rna1:",e),console.log("rna2:",r),n.extraLinks[y].source.rna==e?n.extraLinks[y].target.rna==r||(p.push({source:n.extraLinks[y].target,target:n.extraLinks[y].source.num}),m[n.extraLinks[y].uid]=!0):n.extraLinks[y].source.rna==r&&(n.extraLinks[y].target.rna==e||(p.push({source:n.extraLinks[y].target,target:n.extraLinks[y].source.num+o.length}),m[n.extraLinks[y].uid]=!0)),n.extraLinks[y].target.rna==e?n.extraLinks[y].source.rna==r||(p.push({source:n.extraLinks[y].source,target:n.extraLinks[y].target.num}),m[n.extraLinks[y].uid]=!0):n.extraLinks[y].target.rna==r&&n.extraLinks[y].source.rna==e&&(p.push({source:n.extraLinks[y].source,target:n.extraLinks[y].target.num+o.length}),m[n.extraLinks[y].uid]=!0);n.extraLinks=n.extraLinks.filter(function(t){return!(t.uid in m)}),delete n.rnas[e.uid],delete n.rnas[r.uid];var v=null;v=n.options.animation?n.addRNA(d,{sequence:f,positions:h,centerView:!1}):n.addRNA(d,{sequence:f,centerView:!1});for(var b=0;b<p.length;b++)n.extraLinks.push({source:p[b].source,target:v.nodes[p[b].target-1],value:1,uid:u.a.nice(),linkType:"intermolecule"});F(),n.update(),console.log("self.extraLinks:",n.extraLinks)}(s)},disabled:!1},{title:"Basepair Link",action:function(t,e,r){l=!1,console.log("You have clicked the second item!"),console.log("The data for this circle is: "+e),L.attr("class",i.a.transparent),n.addLink(s)}}];l=!0;var p=f(h);console.log("newLinkMenu"),p.apply(this,[t,e,!0,function(){L.attr("class",i.a.transparent)}])}else r&&n.addLink(s);else r&&n.addLink(s)}},Z=function(t){console.log("nodeMousedown"),t.selected||p||C(),h||(p?R(t):function(t){t.selected=!0,N.selectAll("g.gnode").filter(function(e){return t.uid==e.uid}).classed(i.a.selectedNode,function(t){return t.selected})}(t)),h&&n.options.editable&&(o=t,L.attr("class",i.a.dragLine).attr("x1",o.x).attr("y1",o.y).attr("x2",o.x).attr("y2",o.y),s.a.event.stopPropagation())},Q=function(t){h&&(console.log("d.linkType:",t.linkType),t.linkType in{fake:!0,fake_fake:!0,label_link:!0}||function(t){var e=n.graph.links.indexOf(t);if(console.log("removing link:",e),e>-1){if(t.source.rna==t.target.rna){if("backbone"==t.linkType)return console.log("trying to remove a backbone link",t.source.num,t.target.num),void function(t){if(t.target.num-t.source.num==1){for(var e=t.target.rna,r=[],o=0;o<e.links.length;o++){var i=e.links[o];"basepair"==i.linkType&&i.source.num<=t.source.num&&i.target.num>=t.target.num&&(console.log("crossing basepair",i),r.push(i))}console.log("toRemove:",r);for(var a=0;a<r.length;a++)e.pairtable[r[a].source.num]=0,e.pairtable[r[a].target.num]=0,r[a].from=r[a].source.num,r[a].to=r[a].target.num-t.source.num;e.seq;var s=e.seq.slice(0,t.source.num),l=e.seq.slice(t.source.num),c=g.pairtableToDotbracket(e.pairtable),d=c.slice(0,t.source.num),f=c.slice(t.source.num),h=e.getPositions("nucleotide"),p=e.getUids(),m=h.slice(0,t.source.num),y=h.slice(t.source.num),v=p.slice(0,t.source.num),b=p.slice(t.source.num);console.log("positions1:",m),console.log("positions2:",y),delete n.rnas[e.uid];for(var k=n.addRNA(d,{sequence:s,positions:m,uids:v}),x=n.addRNA(f,{sequence:l,positions:y,uids:b}),w=0;w<r.length;w++)console.log("rna1:",k),console.log("rna2:",x),console.log("toRemove[i]",r[w]),n.extraLinks.push({source:k.nodes[r[w].from-1],target:x.nodes[r[w].to-1],value:1,uid:u.a.nice(),linkType:"intermolecule"}),F(),n.update();console.log("self.extraLinks:",n.extraLinks)}else console.log("ERROR: non adjacent nodes. Target:",t.target,"Source:",t.source,"Link:",t)}(t);var r=t.source.rna;r.addPseudoknots(),r.pairtable[t.source.num]=0,r.pairtable[t.target.num]=0,G(r)}else{var o=n.extraLinks.indexOf(t);n.extraLinks.splice(o,1)}F()}n.update()}(t))};n.toJSON=function(){var t={rnas:n.rnas,extraLinks:n.extraLinks};return JSON.stringify(t,function(t,e){return"rna"==t?void 0:e},"\t")},n.fromJSON=function(t){var e,o;try{var i=JSON.parse(t);e=i.rnas,o=i.extraLinks}catch(t){throw t}for(var a in e)"rna"==e[a].type?(r=new v,r.seq=e[a].seq,r.dotbracket=e[a].dotbracket,r.circular=e[a].circular,r.pairtable=e[a].pairtable,r.uid=e[a].uid,r.structName=e[a].structName,r.nodes=e[a].nodes,r.links=e[a].links,r.rnaLength=e[a].rnaLength,r.elements=e[a].elements,r.nucsToNodes=e[a].nucsToNodes,r.pseudoknotPairs=e[a].pseudoknotPairs):(r=new ProteinGraph,r.size=e[a].size,r.nodes=e[a].nodes,r.uid=e[a].uid),n.addRNAJSON(r,!1);o.forEach(function(t){n.extraLinks.push(t)}),F(),n.update()},n.addRNA=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=U(t,e);if("extraLinks"in e){var o=n.addExternalLinks(r,e.extraLinks);n.extraLinks=n.extraLinks.concat(o)}return"centerPos"in e?n.addRNAJSON(r,{centerPos:e.centerPos,centerView:!1}):"avoidOthers"in e?n.addRNAJSON(r,{avoidOthers:e.avoidOthers}):n.addRNAJSON(r,{centerView:e.centerView}),r},n.addRNAJSON=function(t,e){var r,o,i=e.avoidOthers,a=void 0!==i&&i,l=e.centerPos,u=void 0===l?null:l,c=e.centerView,d=void 0===c||c;if(null!=u){var f=0,h=0,p=0;t.nodes.forEach(function(t){f+=t.x,h+=t.y,p+=1}),p>0&&t.nodes.forEach(function(t){t.x=t.x+u[0]-f/p,t.y=t.y+u[1]-h/p,t.px=t.x,t.py=t.y})}return a&&(r=n.graph.nodes.length>0?s.a.max(n.graph.nodes.map(function(t){return t.x})):0,o=s.a.min(t.nodes.map(function(t){return t.x})),t.nodes.forEach(function(t){t.x+=r-o+20,t.px+=r-o})),t.nodes.forEach(function(e){e.rna=t}),n.rnas[t.uid]=t,F(),n.update(),d&&n.centerView(),t},n.addNodes=function(t){t.links.forEach(function(e){"number"==typeof e.source&&(e.source=t.nodes[e.source]),"number"==typeof e.target&&(e.target=t.nodes[e.target])}),n.graph.nodes.length>0?(maxX=s.a.max(n.graph.nodes.map(function(t){return t.x})),maxY=s.a.max(n.graph.nodes.map(function(t){return t.y}))):(maxX=0,maxY=0),t.nodes.forEach(function(t){t.rna.uid in n.rnas||(n.rnas[t.rna.uid]=t.rna),t.x+=maxX,t.px+=maxX}),r=new v("",""),r.nodes=t.nodes,r.links=t.links,F(),n.update(),n.centerView()},n.clearNodes=function(){n.graph.nodes=[],n.graph.links=[],n.rnas={},n.extraLinks=[],n.update()},n.addLink=function(t){if(console.log("adding new link"),t.source.rna==t.target.rna){var e=t.source.rna;e.pairtable[t.source.num]=t.target.num,e.pairtable[t.target.num]=t.source.num,G(e)}else console.log("intermolecule"),t.linkType="intermolecule",n.extraLinks.push(t);F(),n.update()},n.addExternalLinks=function(t,e){for(var n=[],r=0;r<e.length;r++){var o={linkType:"external",value:1,uid:u.a.nice(),source:null,target:null};if("[object Array]"===Object.prototype.toString.call(e[r][0])){for(var i=0;i<t.nodes.length;i++)if("nucs"in t.nodes[i]&&t.nodes[i].nucs.equals(e[r][0])){o.source=t.nodes[i];break}}else for(var a=0;a<t.nodes.length;a++)t.nodes[a].num==e[r][0]&&(o.source=t.nodes[a]);if("[object Array]"===Object.prototype.toString.call(e[r][1]))for(var s=0;s<t.nodes.length;s++)"nucs"in t.nodes[s]&&t.nodes[s].nucs.equals(e[r][1])&&(o.target=t.nodes[s]);else for(var l=0;l<t.nodes.length;l++)t.nodes[l].num==e[r][1]&&(o.target=t.nodes[l]);null!=o.source&&null!=o.target?n.push(o):console.log("ERROR: source or target of new link not found:",o,e[r])}return n},n.getStructuresDotBracket=function(){console.log("self.rnas:",n.rnas);var t=[],e=1,r={},o=[],i=[];for(var a in n.rnas){for(var s=n.rnas[a],l=0;l<s.nodes.length;l++){var u=s.nodes[l];"nucleotide"==u.nodeType&&(console.log("node:",u),r[u.uid]=e,e+=1,t.push(u.name))}o.push(e)}i=[e-1];for(var c=0;c<e;c++)i.push(0);for(var d in n.rnas)for(var f=n.rnas[d],h=0;h<f.links.length;h++){var p=f.links[h];if("basepair"==p.linkType){var m=r[p.source.uid],y=r[p.target.uid];i[m]=y,i[y]=m}}for(var v=0;v<n.extraLinks.length;v++){var b=n.extraLinks[v],k=r[b.source.uid],x=r[b.target.uid];i[k]=x,i[x]=k}for(var w=g.pairtableToDotbracket(i).split(""),A=0;A<o.length-1;A++)console.log("breaks[i]:",o[A]),t.splice(o[A]+A-1,0,"&"),w.splice(o[A]+A-1,0,"&");return console.log("sequence:",t,t.join("")),console.log("structure:",w,w.join("")),[t.join(""),w.join("")]},n.startAnimation=function(){n.options.animation=!0,A.selectAll("g.gnode").call(O),n.force.start()},n.stopAnimation=function(){n.options.animation=!1,A.selectAll("g.gnode").on("mousedown.drag",null),n.force.stop()},n.resumeForce=function(){n.options.animation&&n.force.resume()},n.setFriction=function(t){n.force.friction(t),n.resumeForce()},n.setCharge=function(t){n.force.charge(t),n.resumeForce()},n.setGravity=function(t){n.force.gravity(t),n.resumeForce()},n.setPseudoknotStrength=function(t){n.linkStrengths.pseudoknot=t,n.update()},n.displayNumbering=function(t){n.displayParameters.displayNumbering=t,j()},n.displayNodeOutline=function(t){n.displayParameters.displayNodeOutline=t,j()},n.displayNodeLabel=function(t){n.displayParameters.displayNodeLabel=t,j()},n.displayLinks=function(t){n.displayParameters.displayLinks=t,j()},n.displayPseudoknotLinks=function(t){n.displayParameters.displayPseudoknotLinks=t,j()},n.displayProteinLinks=function(t){n.displayParameters.displayProteinLinks=t,j()},n.displayDirectionArrows=function(t){n.displayParameters.displayDirectionArrows=t,j()}}function P(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={width:300,height:300,nucleotideRadius:5,rnaEdgePadding:1,labelInterval:10,showNucleotideLabels:!0,startNucleotideNumber:1,bundleExternalLinks:!1,rnaLayout:"simple",namePosition:"0 0"};function o(n){n.each(function(n){var o=d3.select(this).append("g").classed(i.a.plot,!0),a=new v(n.sequence,n.structure,n.name,r.startNucleotideNumber).recalculateElements().elementsToJson().addName(n.name);n.rnaGraph=a;var s=[];if("naview"===r.rnaLayout)for(var l=(new _).naview_xy_coordinates(a.pairtable),u=0;u<l.nbase;u++)s.push([l.x[u],l.y[u]]);else s=b(a.pairtable);a.addPositions("nucleotide",s).addLabels(r.startNucleotideNumber,r.labelInterval);var c=function(n,o){var i=d3.extent(n),a=d3.extent(o);i[0]-=r.nucleotideRadius+r.rnaEdgePadding,a[0]-=r.nucleotideRadius+r.rnaEdgePadding,i[1]+=r.nucleotideRadius+r.rnaEdgePadding,a[1]+=r.nucleotideRadius+r.rnaEdgePadding;var s,l=i[1]-i[0],u=a[1]-a[0];function c(t,e,n){var r=(t.range()[1]-t.range()[0])/(t.domain()[1]-t.domain()[0]),o=(e[1]-e[0])*r,i=(n[1]-n[0]-o)/2;return{scaleFactor:r,scale:d3.scale.linear().domain(e).range([n[0]+i,n[1]-i])}}return l-r.width>u-r.height?(s=c(t=d3.scale.linear().domain(i).range([0,r.width]),a,[0,r.height]),e=s.scale):(s=c(e=d3.scale.linear().domain(a).range([0,r.height]),i,[0,r.width]),t=s.scale),t.range()[0],t.domain()[0],e.range()[0],e.domain()[0],"translate("+-(t.domain()[0]*s.scaleFactor-t.range()[0])+","+-(e.domain()[0]*s.scaleFactor-e.range()[0])+")scale("+s.scaleFactor+")"}(a.nodes.map(function(t){return t.x}),a.nodes.map(function(t){return t.y}));o.attr("transform",c);var d=a.nodes.filter(function(t){return"nucleotide"==t.nodeType}),f=a.nodes.filter(function(t){return"label"==t.nodeType}),h=a.links;!function(t,e){e=e.filter(function(t){return null!==t.source&&null!==t.target}),t.selectAll(".link").data(e).enter().append("svg:line").attr("x1",function(t){return t.source.x}).attr("x2",function(t){return t.target.x}).attr("y1",function(t){return t.source.y}).attr("y2",function(t){return t.target.y}).attr("link-type",function(t){return t.linkType}).attr("extra-link-type",function(t){return t.extraLinkType}).classed("link",!0).classed(i.a.link,!0)}(o,h),function(t,e){var n=t.selectAll(".gnode").data(e).enter().append("svg:g").classed("gnode",!0).attr("transform",function(t){return"translate("+t.x+","+t.y+")"});n.append("svg:circle").classed(i.a.node,!0).attr("node_type","nucleotide").attr("base_type",function(t){if(t.name)return t.name.toLowerCase()}).attr("r",r.nucleotideRadius),r.showNucleotideLabels&&n.append("svg:text").text(function(t){return t.name}).classed(i.a.nodeLabel,!0).append("svg:title").text(function(t){return t.struct_name+":"+t.num})}(o,d),function(t,e){var n=t.selectAll().data(e).enter().append("svg:g").classed("gnode",!0).attr("transform",function(t){return"translate("+t.x+","+t.y+")"});n.append("svg:circle").classed(i.a.node,!0).attr("node_type","label").attr("r",r.nucleotideRadius),n.append("svg:text").classed(i.a.nodeLabel,!0).text(function(t){return t.name})}(o,f),function(t,e){var n=t.append("svg:text").classed(i.a.plotLabel,!0).text(e),o=r.namePosition.split(" ",2),a=[],s=n.node().getBBox(),l=[s.width,s.height],u=[r.width,r.height];for(var c in[0,1])switch(o[c]){case"0":a[c]=l[c]/2;break;case"1":a[c]=u[c]-l[c]/2;break;case"0.5":a[c]=u[c]/2}n.attr("x",a[0]).attr("y",a[1])}(d3.select(this),n.name),r.bundleExternalLinks&&function(t,e){var n={},r=[];e=e.filter(function(t){return"correct"==t.linkType||"incorrect"==t.linkType||"extra"==t.linkType}),t.selectAll("[link-type=extra]").remove();for(var o=0;o<e.length;o++)null!==e[o].source&&null!==e[o].target&&(n[e[o].source.uid]=e[o].source,n[e[o].target.uid]=e[o].target,r.push({source:e[o].source.uid,target:e[o].target.uid,linkType:e[o].linkType,extraLinkType:e[o].extraLinkType}));var i=d3.ForceEdgeBundling().nodes(n).edges(r).compatibility_threshold(.8).step_size(.2)(),a=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear");for(o=0;o<i.length;o++){var s=i[o];t.append("path").attr("d",a(s)).style("fill","none").attr("link-type",function(t){return r[o].linkType}).attr("extra-link-type",function(t){return r[o].extraLinkType}).style("stroke-opacity",.4)}}(o,h)})}return r=Object.assign(r,n),o.width=function(t){return arguments.length?(r.width=t,o):r.width},o.height=function(t){return arguments.length?(r.height=t,o):r.height},o.showNucleotideLabels=function(t){return arguments.length?(r.showNucleotideLabels=t,o):r.showNucleotideLabels},o.rnaEdgePadding=function(t){return arguments.length?(r.rnaEdgePadding=t,o):r.rnaEdgePadding},o.nucleotideRadius=function(t){return arguments.length?(r.nucleotideRadius=t,o):r.nucleotideRadius},o.labelInterval=function(t){return arguments.length?(r.labelInterval=t,o):r.labelInterval},o.showNucleotideLabels=function(t){return arguments.length?(r.showNucleotideLabels=t,o):r.showNucleotideLabels},o.startNucleotideNumber=function(t){return arguments.length?(r.startNucleotideNumber=t,o):r.startNucleotideNumber},o.bundleExternalLinks=function(t){return arguments.length?(r.bundleExternalLinks=t,o):r.bundleExternalLinks},o.rnaLayout=function(t){return arguments.length?(r.rnaLayout=t,o):r.rnaLayout},o.namePosition=function(t){return arguments.length?(r.namePosition=t,o):r.namePosition},o}function T(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={width:300,height:300,nucleotideRadius:5,rnaEdgePadding:1,labelInterval:10,showNucleotideLabels:!0,startNucleotideNumber:1,bundleExternalLinks:!1,rnaLayout:"simple",namePosition:"0 0"};function n(t){t.each(function(t){d3.select(this).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).append("rect").attr("fill","transparent").attr("width",function(t){return Math.max(0,t.dx)}).attr("height",function(t){return Math.max(0,t.dy)});var n=P(e).width(Math.max(0,t.dx)).height(Math.max(0,t.dy));"structure"in t&&d3.select(this).call(n)})}e=Object.assign(e,t);var r=function(t){t.each(function(t){console.log("data:",t);var r=d3.layout.treemap().size([e.width,e.height]).sticky(!1).value(function(t){return t.size});d3.select(this).append("g").classed("rnatreemap",!0).datum(t).selectAll(".treemapnode").data(r.nodes).enter().append("g").classed("treemapnode",!0).call(n)})};return r.width=function(t){return arguments.length?(e.width=t,r):e.width},r.height=function(t){return arguments.length?(e.height=t,r):e.height},r.showNucleotideLabels=function(t){return arguments.length?(e.showNucleotideLabels=t,r):e.showNucleotideLabels},r.rnaEdgePadding=function(t){return arguments.length?(e.rnaEdgePadding=t,r):e.rnaEdgePadding},r.nucleotideRadius=function(t){return arguments.length?(e.nucleotideRadius=t,r):e.nucleotideRadius},r.labelInterval=function(t){return arguments.length?(e.labelInterval=t,r):e.labelInterval},r.showNucleotideLabels=function(t){return arguments.length?(e.showNucleotideLabels=t,r):e.showNucleotideLabels},r.startNucleotideNumber=function(t){return arguments.length?(e.startNucleotideNumber=t,r):e.startNucleotideNumber},r.bundleExternalLinks=function(t){return arguments.length?(e.bundleExternalLinks=t,r):e.bundleExternalLinks},r.rnaLayout=function(t){return arguments.length?(e.rnaLayout=t,r):e.rnaLayout},r.namePosition=function(t){return arguments.length?(e.namePosition=t,r):e.namePosition},r.zoom=function(t){return arguments.length?(e.zoom=t,r):e.zoom},r}_.prototype.naview_xy_coordinates=function(t){var e,n=[],r=[];if(0===t.length||0===t[0])return 0;this.nbase=t[0],this.bases=[];for(var o=0;o<this.nbase+1;o++)this.bases.push(new A);for(this.regions=[],o=0;o<this.nbase+1;o++)this.regions.push(new w.a);for(this.read_in_bases(t),this.rlphead=null,this.find_regions(),this.loop_count=0,this.loops=[],o=0;o<this.nbase+1;o++)this.loops.push(new E.a);for(this.construct_loop(0),this.find_central_loop(),this.traverse_loop(this.root,null),e=0;e<this.nbase;e++)n.push(100+this.BACKBONE_DISTANCE*this.bases[e+1].getX()),r.push(100+this.BACKBONE_DISTANCE*this.bases[e+1].getY());return{nbase:this.nbase,x:n,y:r}},_.prototype.read_in_bases=function(t){var e=null,n=null;for(this.bases.push(new A),this.bases[0].setMate(0),this.bases[0].setExtracted(!1),this.bases[0].setX(this.ANUM),this.bases[0].setY(this.ANUM),n=0,e=1;e<=this.nbase;e++)this.bases.push(new A),this.bases[e].setExtracted(!1),this.bases[e].setX(this.ANUM),this.bases[e].setY(this.ANUM),this.bases[e].setMate(t[e]),t[e]>e&&n++;0==n&&(this.bases[1].setMate(this.nbase),this.bases[this.nbase].setMate(1))},_.prototype.find_regions=function(){var t,e=null,n=null;t=this.nbase+1;var r=[];for(e=0;e<t;e++)r.push(!1);for(this.nregion=0,e=0;e<=this.nbase;e++)if(0!=(n=this.bases[e].getMate())&&!r[e]){for(this.regions[this.nregion].setStart1(e),this.regions[this.nregion].setEnd2(n),r[e]=!0,r[n]=!0,this.bases[e].setRegion(this.regions[this.nregion]),this.bases[n].setRegion(this.regions[this.nregion]),e++,n--;e<n&&this.bases[e].getMate()==n;e++,n--)r[n]=!0,r[e]=!0,this.bases[e].setRegion(this.regions[this.nregion]),this.bases[n].setRegion(this.regions[this.nregion]);this.regions[this.nregion].setEnd1(--e),this.regions[this.nregion].setStart2(n+1),this.nregion++}},_.prototype.construct_loop=function(t){var e=null,n=null,r=new E.a,o=new E.a,i=new x.Connection,a=new w.a,s=new k;for((r=this.loops[this.loop_count++]).setNconnection(0),r.setDepth(0),r.setNumber(this.loop_count),r.setRadius(0),s=this.rlphead;null!=s;s=s.getNext())s.getLoopnumber()==this.loop_count&&r.setRadius(s.getRadius());e=t;do{0!=(n=this.bases[e].getMate())&&(a=this.bases[e].getRegion(),this.bases[a.getStart1()].isExtracted()||(e==a.getStart1()?(this.bases[a.getStart1()].setExtracted(!0),this.bases[a.getEnd1()].setExtracted(!0),this.bases[a.getStart2()].setExtracted(!0),this.bases[a.getEnd2()].setExtracted(!0),o=this.construct_loop(a.getEnd1()<this.nbase?a.getEnd1()+1:0)):e==a.getStart2()?(this.bases[a.getStart2()].setExtracted(!0),this.bases[a.getEnd2()].setExtracted(!0),this.bases[a.getStart1()].setExtracted(!0),this.bases[a.getEnd1()].setExtracted(!0),o=this.construct_loop(a.getEnd2()<this.nbase?a.getEnd2()+1:0)):console.log("Something went terribly wrong ...."),r.setNconnection(r.getNconnection()+1),i=new x.Connection,r.setConnection(r.getNconnection()-1,i),r.setConnection(r.getNconnection(),null),i.setLoop(o),i.setRegion(a),e==a.getStart1()?(i.setStart(a.getStart1()),i.setEnd(a.getEnd2())):(i.setStart(a.getStart2()),i.setEnd(a.getEnd1())),i.setExtruded(!1),i.setBroken(!1),o.setNconnection(o.getNconnection()+1),i=new x.Connection,o.setConnection(o.getNconnection()-1,i),o.setConnection(o.getNconnection(),null),i.setLoop(r),i.setRegion(a),e==a.getStart1()?(i.setStart(a.getStart2()),i.setEnd(a.getEnd1())):(i.setStart(a.getStart1()),i.setEnd(a.getEnd2())),i.setExtruded(!1),i.setBroken(!1)),e=n),++e>this.nbase&&(e=0)}while(e!=t);return r},_.prototype.find_central_loop=function(){var t=new E.a,e=null,n=null,r=null;for(function(){var t=new E.a,e=null,n=null;for(e=0;e<this.loop_count;e++){for(t=this.loops[e],n=0;n<this.loop_count;n++)this.loops[n].setMark(!1);t.setDepth(N(t))}}.bind(this)(),e=0,n=-1,r=0;r<this.loop_count;r++)(t=this.loops[r]).getNconnection()>e?(n=t.getDepth(),e=t.getNconnection(),this.root=t):t.getDepth()>n&&t.getNconnection()==e&&(n=t.getDepth(),this.root=t)},_.prototype.traverse_loop=function(t,e){var n,r,o,i,a,s,l,u,c,d,f,h,p,g,m,y,v,b,k,x,w,A,E,_,N,L,P,T,M,S,R,C,I,Y,B,O,U,X,D,z,q,F,j,V,H,W,J,G,K,Z,Q,$,tt,et,nt,rt,ot,it,at,st,lt,ut,ct,dt,ft,ht,pt,gt,mt,yt=0;s=2*Math.PI/(this.nbase+1),b=null,S=-1;var vt=0;for(E=0;null!=(y=t.getConnection(vt));vt++,E++)n=-Math.sin(s*y.getStart()),r=Math.cos(s*y.getStart()),o=-Math.sin(s*y.getEnd()),i=Math.cos(s*y.getEnd())-r,a=n-o,l=Math.sqrt(i*i+a*a),y.setXrad(i/l),y.setYrad(a/l),y.setAngle(Math.atan2(a,i)),y.getAngle()<0&&y.setAngle(y.getAngle()+2*Math.PI),null!=e&&e.getRegion()==y.getRegion()&&(b=y,S=E);t:for(;;){this.determine_radius(t,this.lencut),u=t.getRadius()/this.RADIUS_REDUCTION_FACTOR,null==e?c=d=0:(f=(this.bases[b.getStart()].getX()+this.bases[b.getEnd()].getX())/2,h=(this.bases[b.getStart()].getY()+this.bases[b.getEnd()].getY())/2,c=f-u*b.getXrad(),d=h-u*b.getYrad()),P=-1==S?0:S,y=t.getConnection(P),L=0,R=!1;do{if((w=P-1)<0&&(w=t.getNconnection()-1),k=t.getConnection(w),this.connected_connection(k,y)?(P=w,y=k):R=!0,++L>t.getNconnection()){for(N=-1,E=0;E<t.getNconnection();E++)(w=E+1)>=t.getNconnection()&&(w=0),y=t.getConnection(E),(ft=(v=t.getConnection(w)).getAngle()-y.getAngle())<0&&(ft+=2*Math.PI),ft>N&&(N=ft,yt=E);T=yt,(P=yt+1)>=t.getNconnection()&&(P=0),(y=t.getConnection(T)).setBroken(!0),R=!0}}while(!R);for(C=!1,W=P;!C;){for(L=0,R=!1,T=P,I=!1;!R;)if(y=t.getConnection(T),T==S&&(I=!0),(w=T+1)>=t.getNconnection()&&(w=0),v=t.getConnection(w),this.connected_connection(y,v)){if(++L>=t.getNconnection())break;T=w}else R=!0;for(E=J=G=M=this.find_ic_middle(P,T,e,b,t),R=!1,Z=0;!R;)(E=Z<0?J:0==Z?M:G)>=0&&(y=t.getConnection(E),null!=e&&b==y||(0==Z?(p=y.getAngle()-Math.asin(.5/u),g=y.getAngle()+Math.asin(.5/u),this.bases[y.getStart()].setX(c+u*Math.cos(p)),this.bases[y.getStart()].setY(d+u*Math.sin(p)),this.bases[y.getEnd()].setX(c+u*Math.cos(g)),this.bases[y.getEnd()].setY(d+u*Math.sin(g))):Z<0?((w=E+1)>=t.getNconnection()&&(w=0),y=t.getConnection(E),v=t.getConnection(w),nt=y.getXrad(),rt=y.getYrad(),ft=(y.getAngle()+v.getAngle())/2,y.getAngle()>v.getAngle()&&(ft-=Math.PI),at=Math.cos(ft),ut=Math.sin(ft),ct=-at,(_=v.getAngle()-y.getAngle())<0&&(_+=2*Math.PI),dt=y.isExtruded()?_<=Math.PI/2?2:1.5:1,this.bases[y.getEnd()].setX(this.bases[v.getStart()].getX()+dt*ut),this.bases[y.getEnd()].setY(this.bases[v.getStart()].getY()+dt*ct),this.bases[y.getStart()].setX(this.bases[y.getEnd()].getX()+rt),this.bases[y.getStart()].setY(this.bases[y.getEnd()].getY()-nt)):((w=E-1)<0&&(w=t.getNconnection()-1),y=t.getConnection(w),ot=(v=t.getConnection(E)).getXrad(),it=v.getYrad(),ft=(y.getAngle()+v.getAngle())/2,y.getAngle()>v.getAngle()&&(ft-=Math.PI),at=Math.cos(ft),ut=-Math.sin(ft),ct=at,(_=v.getAngle()-y.getAngle())<0&&(_+=2*Math.PI),dt=y.isExtruded()?_<=Math.PI/2?2:1.5:1,this.bases[v.getStart()].setX(this.bases[y.getEnd()].getX()+dt*ut),this.bases[v.getStart()].setY(this.bases[y.getEnd()].getY()+dt*ct),this.bases[v.getEnd()].setX(this.bases[v.getStart()].getX()-it),this.bases[v.getEnd()].setY(this.bases[v.getStart()].getY()+ot)))),Z<0?(G==T?G=-1:G>=0&&++G>=t.getNconnection()&&(G=0),Z=1):(J==P?J=-1:J>=0&&--J<0&&(J=t.getNconnection()-1),Z=-1),R=-1==J&&-1==G;if((K=T+1)>=t.getNconnection()&&(K=0),T!=P&&(P!=W||K!=W))if(y=t.getConnection(P),v=t.getConnection(T),$=this.bases[v.getEnd()].getX()-this.bases[y.getStart()].getX(),tt=this.bases[v.getEnd()].getY()-this.bases[y.getStart()].getY(),B=this.bases[y.getStart()].getX()+$/2,O=this.bases[y.getStart()].getY()+tt/2,D=$/(et=Math.sqrt($*$+tt*tt)),z=tt/et,q=c-B,F=d-O,U=(j=(q/=et=Math.sqrt($*$+tt*tt))*D+(F/=et)*z)*D-q,X=j*z-F,U/=et=Math.sqrt(U*U+X*X),X/=et,$=this.bases[y.getStart()].getX()-c,tt=this.bases[y.getStart()].getY()-d,(ft=Math.atan2(tt,$))<0&&(ft+=2*Math.PI),$=this.bases[v.getEnd()].getX()-c,tt=this.bases[v.getEnd()].getY()-d,(ht=Math.atan2(tt,$))<0&&(ht+=2*Math.PI),ht<ft&&(ht+=2*Math.PI),V=c+(Y=ht-ft>Math.PI?-1:1)*u*U,H=d+Y*u*X,I)c-=V-B,d-=H-O;else for(E=P;x=(y=t.getConnection(E)).getStart(),this.bases[x].setX(this.bases[x].getX()+V-B),this.bases[x].setY(this.bases[x].getY()+H-O),x=y.getEnd(),this.bases[x].setX(this.bases[x].getX()+V-B),this.bases[x].setY(this.bases[x].getY()+H-O),E!=T;)++E>=t.getNconnection()&&(E=0);C=(P=K)==W}for(E=0;E<t.getNconnection();E++){if(y=t.getConnection(E),(w=E+1)>=t.getNconnection()&&(w=0),v=t.getConnection(w),$=this.bases[y.getEnd()].getX()-c,tt=this.bases[y.getEnd()].getY()-d,lt=Math.sqrt($*$+tt*tt),(ft=Math.atan2(tt,$))<0&&(ft+=2*Math.PI),$=this.bases[v.getStart()].getX()-c,tt=this.bases[v.getStart()].getY()-d,st=Math.sqrt($*$+tt*tt),(ht=Math.atan2(tt,$))<0&&(ht+=2*Math.PI),ht<ft&&(ht+=2*Math.PI),Q=ht-ft,(mt=v.getAngle()-y.getAngle())<=0&&(mt+=2*Math.PI),Math.abs(Q-mt)>Math.PI)if(y.isExtruded())console.log("Warning from traverse_loop. Loop "+t.getNumber()+" has crossed regions\n");else if(v.getStart()-y.getEnd()!=1){y.setExtruded(!0);continue t}if(y.isExtruded())this.construct_extruded_segment(y,v);else for((A=v.getStart()-y.getEnd())<0&&(A+=this.nbase+1),s=Q/A,w=1;w<A;w++)(x=y.getEnd()+w)>this.nbase&&(x-=this.nbase+1),et=lt+(st-lt)*((m=ft+w*s)-ft)/Q,this.bases[x].setX(c+et*Math.cos(m)),this.bases[x].setY(d+et*Math.sin(m))}break}for(E=0;E<t.getNconnection();E++)S!=E&&(y=t.getConnection(E),this.generate_region(y),this.traverse_loop(y.getLoop(),y));for(A=0,pt=0,gt=0,E=0;E<t.getNconnection();E++)if((w=E+1)>=t.getNconnection()&&(w=0),y=t.getConnection(E),v=t.getConnection(w),A+=2,pt+=this.bases[y.getStart()].getX()+this.bases[y.getEnd()].getX(),gt+=this.bases[y.getStart()].getY()+this.bases[y.getEnd()].getY(),!y.isExtruded())for(w=y.getEnd()+1;w!=v.getStart();w++)w>this.nbase&&(w-=this.nbase+1),A++,pt+=this.bases[w].getX(),gt+=this.bases[w].getY();t.setX(pt/A),t.setY(gt/A)},_.prototype.determine_radius=function(t,e){var n,r,o,i,a,s,l,u,c,d,f,h=0,p=new x.Connection,g=new x.Connection;do{for(n=1e10,a=0,i=0,u=0;u<t.getNconnection();u++)p=t.getConnection(u),(c=u+1)>=t.getNconnection()&&(c=0),g=t.getConnection(c),d=p.getEnd(),(f=g.getStart())<d&&(f+=this.nbase+1),(o=g.getAngle()-p.getAngle())<=0&&(o+=2*Math.PI),i+=o*(1/(r=p.isExtruded()?o<=Math.PI/2?2:1.5:f-d)+1),a+=o*o/r,(l=o/r)<n&&!p.isExtruded()&&r>1&&(n=l,h=u);(s=i/a)<.7071068&&(s=.7071068),n*s<e&&t.getConnection(h).setExtruded(!0)}while(n*s<e);t.getRadius()>0?s=t.getRadius():t.setRadius(s)},_.prototype.find_ic_middle=function(t,e,n,r,o){var i,a,s,l,u;for(i=0,a=-1,s=t,u=!1;!u;)i++>2*o.getNconnection()&&console.log("Infinite loop in 'find_ic_middle'"),null!=n&&o.getConnection(s)==r&&(a=s),u=s==e,++s>=o.getNconnection()&&(s=0);if(-1==a){for(l=1,s=t;l<(i+1)/2;l++)++s>=o.getNconnection()&&(s=0);a=s}return a},_.prototype.construct_extruded_segment=function(t,e){var n,r,o,i,a,s,l,u,c,d,f,h,p,g,m,y,v,b;if(n=t.getAngle(),(o=r=e.getAngle())<n&&(o+=2*Math.PI),i=(n+o)/2,p=t.getEnd(),(m=(g=e.getStart())-p)<0&&(m+=this.nbase+1),(f=e.getAngle()-t.getAngle())<0&&(f+=2*Math.PI),2==m)this.construct_circle_segment(p,g);else{a=this.bases[g].getX()-this.bases[p].getX(),s=this.bases[g].getY()-this.bases[p].getY(),a/=d=Math.sqrt(a*a+s*s),s/=d,d>=1.5&&f<=Math.PI/2&&((y=p+1)>this.nbase&&(y-=this.nbase+1),(v=g-1)<0&&(v+=this.nbase+1),this.bases[y].setX(this.bases[p].getX()+.5*a),this.bases[y].setY(this.bases[p].getY()+.5*s),this.bases[v].setX(this.bases[g].getX()-.5*a),this.bases[v].setY(this.bases[g].getY()-.5*s),p=y,g=v);do{b=!1,this.construct_circle_segment(p,g),(y=p+1)>this.nbase&&(y-=this.nbase+1),a=this.bases[y].getX()-this.bases[p].getX(),s=this.bases[y].getY()-this.bases[p].getY(),(l=Math.atan2(s,a))<0&&(l+=2*Math.PI),(h=l-n)<0&&(h+=2*Math.PI),h>Math.PI&&(b=!0),(v=g-1)<0&&(v+=this.nbase+1),a=this.bases[v].getX()-this.bases[g].getX(),s=this.bases[v].getY()-this.bases[g].getY(),(u=Math.atan2(s,a))<0&&(u+=2*Math.PI),(h=r-u)<0&&(h+=2*Math.PI),h>Math.PI&&(b=!0),b&&(c=this.minf2(i,n+.5),this.bases[y].setX(this.bases[p].getX()+Math.cos(c)),this.bases[y].setY(this.bases[p].getY()+Math.sin(c)),p=y,c=this.maxf2(i,o-.5),this.bases[v].setX(this.bases[g].getX()+Math.cos(c)),this.bases[v].setY(this.bases[g].getY()+Math.sin(c)),g=v,m-=2)}while(b&&m>1)}},_.prototype.construct_circle_segment=function(t,e){var n,r,o,i,a,s,l,u,c,d,f,h,p,g,m;if(n=this.bases[e].getX()-this.bases[t].getX(),r=this.bases[e].getY()-this.bases[t].getY(),o=Math.sqrt(n*n+r*r),(p=e-t)<0&&(p+=this.nbase+1),o>=p)for(n/=o,r/=o,g=1;g<p;g++)(m=t+g)>this.nbase&&(m-=this.nbase+1),this.bases[m].setX(this.bases[t].getX()+n*g/p),this.bases[m].setY(this.bases[t].getY()+r*g/p);else for(this.find_center_for_arc(p-1,o),n/=o,r/=o,i=this.bases[t].getX()+n*o/2,a=this.bases[t].getY()+r*o/2,s=r,l=-n,u=i+this._h*s,c=a+this._h*l,d=this.bases[t].getX()-u,f=this.bases[t].getY()-c,o=Math.sqrt(d*d+f*f),h=Math.atan2(f,d),g=1;g<p;g++)(m=t+g)>this.nbase&&(m-=this.nbase+1),this.bases[m].setX(u+o*Math.cos(h+g*this.angleinc)),this.bases[m].setY(c+o*Math.sin(h+g*this.angleinc))},_.prototype.find_center_for_arc=function(t,e){var n,r,o,i,a,s,l,u;o=-(r=(t+1)/Math.PI)-e/(t+1.000001-e),e<1&&(o=0),u=0;do{n=(r+o)/2,a=1-.5/((i=Math.sqrt(n*n+e*e/4))*i),Math.abs(a)>1&&console.log("Unexpected large magnitude discriminant = "+a+" "+i),(l=(s=Math.acos(a))*(t+1)+2*Math.acos(n/i)-2*Math.PI)>0?o=n:r=n}while(Math.abs(l)>1e-4&&++u<this.MAXITER);u>=this.MAXITER&&(noIterationFailureYet&&(console.log("Iteration failed in find_center_for_arc"),noIterationFailureYet=!1),n=0,s=0),this._h=n,this.angleinc=s},_.prototype.generate_region=function(t){var e,n,r,o,i,a;for(a=t.getRegion(),e=0,t.getStart()==a.getStart1()?(n=a.getStart1(),r=a.getEnd1()):(n=a.getStart2(),r=a.getEnd2()),(this.bases[t.getStart()].getX()>this.ANUM-100||this.bases[t.getEnd()].getX()>this.ANUM-100)&&console.log("Bad region passed to generate_region. Coordinates not defined."),o=n+1;o<=r;o++)e++,this.bases[o].setX(this.bases[t.getStart()].getX()+this.HELIX_FACTOR*e*t.getXrad()),this.bases[o].setY(this.bases[t.getStart()].getY()+this.HELIX_FACTOR*e*t.getYrad()),i=this.bases[o].getMate(),this.bases[i].setX(this.bases[t.getEnd()].getX()+this.HELIX_FACTOR*e*t.getXrad()),this.bases[i].setY(this.bases[t.getEnd()].getY()+this.HELIX_FACTOR*e*t.getYrad())},_.prototype.minf2=function(t,e){return t<e?t:e},_.prototype.maxf2=function(t,e){return t>e?t:e},_.prototype.connected_connection=function(t,e){return!!t.isExtruded()||t.getEnd()+1==e.getStart()},n.d(e,"FornaContainer",function(){return L}),n.d(e,"rnaPlot",function(){return P}),n.d(e,"rnaTreemap",function(){return T}),n.d(e,"RNAUtilities",function(){return p}),n.d(e,"ColorScheme",function(){return m})}]))},function(t,e,n){"use strict";n.r(e),n.d(e,"cotranscriptionalTimeSeriesLayout",function(){return u}),n.d(e,"currentTimepointTable",function(){return c}),n.d(e,"cotranscriptionalSmallMultiplesLayout",function(){return d});var r=n(0),o=n.n(r),i=n(2),a=(n(4),n(1)),s=n.n(a),l=new i.RNAUtilities;function u(){var t,e,n,r,a,u,c={animation:!1,editable:!1,zoomable:!1,labelInterval:0,transitionDuration:0},d={top:0,right:0,bottom:40,left:50},f=700,h=400,p=null,g=null,m=.01,y=f-d.left-d.right,v=.85*h-d.top-d.bottom,b=f-d.left-d.right,k=h-v-d.top-d.bottom,x=o.a.scale.log().interpolate(o.a.interpolateRound).range([0,b]),w=o.a.scale.linear().interpolate(o.a.interpolateRound).range([k,0]),A=o.a.scale.log().interpolate(o.a.interpolateRound).range([0,b]),E=o.a.scale.linear().interpolate(o.a.interpolateRound).range([k,0]),_=o.a.scale.category20(),N=null,L=null,P=0,T=null,M=null,S=null,R=null,C=null,I=null,Y=null,B=null,O=null,U=null,X=null,D=0;function z(f){f.each(function(f){function h(t){return"div"+t.name}e=o.a.layout.treemap().size([y,v]).sticky(!1).value(function(t){return t.size}),n=o.a.select(this).append("div").classed(s.a.plot,!0),r=n.append("div").classed(s.a.treemap,!0).style("left",d.left+"px"),a=n.append("div").classed(s.a.lineChart,!0).style("left","0px"),u=a.append("svg").attr("preserveAspectRatio","xMidYMid meet").attr("width",b).attr("height",k).append("g").attr("transform","translate("+d.left+","+d.top+")"),t=o.a.svg.line().interpolate("basis").x(function(t){return x(+t.time)}).y(function(t){return w(+t.conc)});var q=o.a.bisector(function(t){return t.time}).left;function F(){this.style("left",function(t){return t.x+"px"}).style("top",function(t){return t.y+"px"}).style("width",function(t){return 0==t.dy||t.dx<10?"0px":Math.max(0,t.dx)+"px"}).style("height",function(t){return 0==t.dx||t.dy<10?"0px":Math.max(0,t.dy)+"px"})}!function(){var t=function(t){return o.a.hcl(360*t,100,55)},a=o.a.scale.linear().range([0,1]);null==g?a.domain([0,f[f.length-1].struct.length]):a.domain([0,g]),function(e){e.forEach(function(e,n){e.time=+e.time,e.conc=+e.conc;for(var r=l.dotbracketToPairtable(e.struct),i=l.ptToElements(r,0,1,r[0],[]),s=Array(r[0]).fill(o.a.hsl("white")),u=function(e){if("s"!=i[e][0])return"continue";var n=i[e][2].reduce(function(t,e){return t+e},0)/i[e][2].length;i[e][2].map(function(e){var r=a(n);s[e-1]=t(r)})},c=0;c<i.length;c++)u(c);e.colors=s})}(f);var d=o.a.nest().key(function(t){return+t.time}).entries(f);!function(t){t.forEach(function(t){t.values.sort(function(t,e){return+e.conc-+t.conc})})}(d),_.domain(o.a.set(f.map(function(t){return t.id})).values()),null!=p?x.domain([.1,p]):x.domain(o.a.extent(f,function(t){return+t.time})),C=o.a.svg.axis().scale(x).orient("bottom"),I=o.a.svg.axis().scale(w).orient("left").ticks(0);var y=0,v=!1;T=u.append("g").classed(s.a.x,!0).classed(s.a.axis,!0).call(C),M=u.append("g").classed(s.a.y,!0).classed(s.a.axis,!0),S=M.append("text").attr("dy",".71em").style("text-anchor","middle").text("Time (Seconds)"),u.append("g").classed(s.a.y,!0).classed(s.a.axis,!0).attr("transform","translate(0,0)").append("text").attr("transform","translate(-25,0)rotate(-90)").style("text-anchor","end").text("Nucleotide"),u.append("g").classed(s.a.y,!0).classed(s.a.axis,!0).attr("transform","translate(0,0)").append("text").attr("transform","translate(-10,5)rotate(-90)").style("text-anchor","end").text("Position");for(var j=0;j<d.length;j++)d[j].dt=0,j<d.length-1&&(d[j].dt=+d[j+1].key-+d[j].key),D=+d[j].values[0].struct.length;o.a.min(d.map(function(t){return+t.key})),o.a.max(d.map(function(t){return+t.key})),A.domain(x.domain()),E.domain([0,D]),X=u.selectAll(".data-rectangle-group").data(d).enter().append("g").classed("data-rectangle-group",!0).attr("transform",function(t){return"translate(".concat(A(+t.key),",0)")}).each(function(t){var e=Math.abs(E.range()[1]-E.range()[0])/D,n=Math.abs(A(+t.key)-A(+t.key+t.dt));A(+t.key),o.a.select(this).selectAll(".data-rectangle").data(t.values[0].colors).enter().append("rect").classed("data-rectangle",!0).attr("y",function(t,e){return E(e)}).attr("height",e).attr("width",n).attr("fill",function(t){return t})}),R=u.append("line").attr("x1",P).attr("y1",0).attr("x2",P).attr("y2",k).classed(s.a.timeIndicator,!0);var V=f.filter(function(t){return t.conc>m}),H=o.a.nest().key(function(t){return+t.id}).entries(V);u.selectAll(".concProfile").data(H).enter().append("g").attr("class","concProfile"),O=function(t){return{name:"graph",children:t.map(function(e){return{name:e.key,struct:e.values[0].struct,size:1/t.length,colors:e.values[0].colors}})}}(H);var W=[],J={};r.datum(O).selectAll("."+s.a.treemapNode).data(e.nodes).enter().append("div").attr("class",s.a.treemapNode).attr("id",h).call(F).each(function(t){if(void 0!==t.struct){J[h(t)]=new i.FornaContainer("#"+h(t),c),J[h(t)].transitionRNA(t.struct);var e=t.colors.map(function(t,e){return"".concat(e+1,":").concat(t)}).join(" ");J[h(t)].addCustomColorsText(e)}}),Y=u.append("rect").attr("class",s.a.overlay).on("mouseover",function(){}).on("mousemove",function(){y=o.a.mouse(this)[0],U(y)}).on("click",function(){null!=L&&L(W)}),n.on("mouseenter",function(){v=!1}).on("mouseleave",function(){v=!0,U(y)}),B=function(t){r.datum(t).selectAll("."+s.a.treemapNode).data(e.nodes).call(F)},U=function(t){var e=function(t){var e=x.invert(t);return q(f,e,1),H.map(function(t){var n=q(t.values,e,0),r=function(t){return t.map(function(t){return t.rgb().toString()})};if(n>=t.values.length||0==n)return{time:t.values[0].time,name:t.key,struct:t.values[0].struct,energy:Number(t.values[0].energy),colors:r(t.values[0].colors),size:0};var i=o.a.scale.linear().domain([t.values[n-1].time,t.values[n].time]).range([t.values[n-1].conc,t.values[n].conc])(e),a={time:t.values[n].time,name:t.key,struct:t.values[n].struct,energy:Number(t.values[n].energy),colors:r(t.values[n].colors),size:+i};return J[h(a)].transitionRNA(t.values[n].struct),a})}(t);W=e.filter(function(t){return t.size>0}).sort(function(t,e){return e.size-t.size}),null!=N&&N(W),B(O={name:"graph",children:e}),R.attr("x1",t).attr("x2",t),v&&(y+=b/100)},z.updateCurrentTime=U}()}),q()}var q=function(){y=f-d.left-d.right,v=.85*h-d.top-d.bottom,k=h-v-d.top-d.bottom,b=f-d.left-d.right,k=h-v-d.top-d.bottom,x=x.range([0,b]),w=w.range([k,0]),A.range([0,b]),E.range([k,0]),n.style("width",y+d.left+d.right+"px").style("height",v+k+d.top+d.bottom+"px"),r.style("width",y+"px").style("height",v+"px"),a.style("width",b+d.left+"px").style("height",k+d.bottom+d.top+"px").style("top",v+"px"),a.select("svg").attr("width",b).attr("height",k),t.x(function(t){return x(+t.time)}).y(function(t){return w(+t.conc)}),null!=T&&T.attr("transform","translate(0,"+k+")"),null!=M&&M.attr("transform","translate(0,0)"),null!=C&&(C.scale(x),T.call(C)),null!=I&&(I.scale(w),M.call(I)),null!=Y&&Y.attr("width",b).attr("height",k),null!=X&&(X.attr("transform",function(t){return"translate(".concat(A(+t.key),",0)")}),X.each(function(t){var e=Math.abs(A(+t.key)-A(+t.key+t.dt));A(+t.key);o.a.select(this).selectAll(".data-rectangle").attr("y",function(t,e){return E(e)}).attr("height",Math.abs(E.range()[1]-E.range()[0])/D).attr("width",e)})),null!=S&&S.attr("x",b/2).attr("y",k+25),null!=R&&R.attr("y2",k),e.size([y,v]),null!=B&&B(O)};return z.updateDimensions=q,z.width=function(t){return arguments.length?(f=t,z):f},z.height=function(t){return arguments.length?(h=t,z):h},z.newTimePointCallback=function(t){return arguments.length?(N=t,z):c.newTimePointCallback},z.newTimeClickCallback=function(t){return arguments.length?(L=t,z):c.newTimeClickCallback},z.margin=function(t){return d},z.occupancyTreshold=function(t){return arguments.length?(m=t,z):m},z.simulationTime=function(t){return arguments.length?(p=t,z):p},z.sequenceLength=function(t){return arguments.length?(g=t,z):g},z}function c(t){var e=["name","struct","size","energy"];o.a.select(t).selectAll("table").remove();var n=o.a.select(t).append("table").classed(s.a.timePointTable,!0),r=n.append("thead"),i=n.append("tbody");r.append("tr").selectAll("th").data(["ID","Structure","Occupancy","Energy"]).enter().append("th").text(function(t){return t});var a=function(t,e){var n=o.a.select(this);n.selectAll("span").remove();for(var r=function(e){n.append("span").style("background-color",t.colors[e]).text(function(n){return t.value[e]})},i=0;i<t.value.length;i++)r(i)};return function(t){t.each(function(t){var n=i.selectAll("tr").data(t);n.enter().append("tr"),n.exit().remove();var r=i.selectAll("tr").selectAll("td").data(function(t){return e.map(function(e){var n={column:e,value:t[e]};return"struct"==e&&(n.colors=t.colors),n})});r.enter().append("td").attr("class",function(t){return s.a["table"+t.column]}),r.exit().remove(),r.text(function(t){if(!isNaN(t.value))return Math.round(100*t.value)/100}),r.filter(function(t){return"struct"==t.column}).each(a)})}}function d(){var t=[10,10],e=550;function n(t){var e;if("seq"in t)return t.seq;e="";for(var n=0;n<t.struct.length;n++)e+="A";return e}var r=function(r){r.each(function(r){var a=o.a.nest().key(function(t){return t.time}).entries(r);a.sort(function(t,e){return+t.key-+e.key});var l=a.map(function(t){return{children:t.values.map(function(t){return{structure:t.struct,sequence:n(t),size:t.conc,time:t.time}})}}),u=Math.floor((e+t[0])/(160+t[0])),c=Math.ceil(l.length/u)*(160+t[1])-t[1],d=Object(i.rnaTreemap)().width(160).height(145),f=o.a.layout.grid().bands().size([e,c]).cols(u).padding(t).nodeSize([160,160])(l).map(function(t){return t.pos={x:t.x,y:t.y},t}),h=o.a.select(this).append("svg").attr("preserveAspectRatio","xMidYMid meet").attr("viewBox","0 0 "+e+" "+c);h.selectAll(".rna-treemap").data(f).enter().append("g").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).classed("rna-treemap",!0).call(d),h.selectAll(".time-g").data(f).enter().append("g").attr("transform",function(t){return"translate("+t.pos.x+","+t.pos.y+")"}).classed("time-g",!0).append("text").attr("x",80).attr("y",161).classed(s.a.timeLabel,!0).text(function(t){return"time: "+t.children[0].time})})};return r.width=function(t){return arguments.length?(e=t,r):e},r.height=function(t){return arguments.length?r:0},r}},function(t,e,n){t.exports={nodeStrokeWidth:"0.8",directionArrowSize:"6",directionArrowWidth:"0.7",node:"fornac-node",directionArrow:"fornac-directionArrow",plot:"fornac-plot",selectedNode:"fornac-selectedNode",nodeLabel:"fornac-nodeLabel",link:"fornac-link",plotLabel:"fornac-plotLabel",transparent:"fornac-transparent",dragLine:"fornac-dragLine",mouseEventHelper:"fornac-mouseEventHelper"}}])});
//# sourceMappingURL=drforna.js.map